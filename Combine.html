<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Combine.html</title>
  <meta name="generator" content="Haroopad 0.13.2" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node ellipse,.node polygon,.node rect{fill:#ECECFF;stroke:#CCF;stroke-width:1px}.edgePath .path{stroke:#333}.edgeLabel{background-color:#e8e8e8}.cluster rect{fill:#ffffde!important;rx:4!important;stroke:#aa3!important;stroke-width:1px!important}.cluster text{fill:#333}.actor{stroke:#CCF;fill:#ECECFF}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#CCF;fill:#ECECFF}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#CCF}.note{stroke:#aa3;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0{fill:rgba(102,102,255,.49)}.section2{fill:#fff400}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#8a90dd;stroke:#534fbc}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#bfc7ff;stroke:#534fbc}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}.node text{font-family:'trebuchet ms',verdana,arial;font-size:14px}div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:'trebuchet ms',verdana,arial;font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}html{height:100%}body{padding:5px 20px 26px;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}div.toc{margin:0!important}div.toc ul{padding-left:10px}div.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}div.toc li,div.toc ul{list-style-type:none}div.toc li{width:100%;padding:0;overflow:hidden}div.toc li a::after{content:"."}div.toc li a:before{content:"• "}div.toc h5{text-transform:uppercase}div.toc .title{float:left;padding-right:3px}div.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre.hljs,.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.github{padding:20px;font-family:"Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Segoe UI",AppleSDGothicNeo-Medium,'Malgun Gothic',Arial,freesans,sans-serif;font-size:15px;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.github a{color:#3269a0}.github a:hover{color:#4183c4}.github h2{border-bottom:1px solid #e6e6e6;line-height:1.6}.github h6{color:#777}.github hr{border:1px solid #e6e6e6}.github pre>code{font-size:.9em;font-family:Consolas,Inconsolata,Courier,monospace}.github blockquote>code,.github h1>code,.github h2>code,.github h3>code,.github h4>code,.github h5>code,.github h6>code,.github li>code,.github p>code,.github td>code{background-color:rgba(0,0,0,.07);font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;padding:.2em .5em;border:0}.github blockquote{border-left:4px solid #e6e6e6;padding:0 15px;font-style:italic}.github table{background-color:#fafafa}.github table tr td,.github table tr th{border:1px solid #e6e6e6}.github table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;background:#fdf6e3;color:#657b83;-webkit-text-size-adjust:none}.diff .hljs-header,.hljs-comment,.hljs-doctype,.hljs-pi,.lisp .hljs-string{color:#93a1a1}.css .hljs-tag,.hljs-addition,.hljs-keyword,.hljs-request,.hljs-status,.hljs-winutils,.method,.nginx .hljs-title{color:#859900}.hljs-command,.hljs-doctag,.hljs-hexcolor,.hljs-link_url,.hljs-number,.hljs-regexp,.hljs-rule .hljs-value,.hljs-string,.hljs-tag .hljs-value,.tex .hljs-formula{color:#2aa198}.css .hljs-function,.hljs-built_in,.hljs-chunk,.hljs-decorator,.hljs-id,.hljs-identifier,.hljs-localvars,.hljs-name,.hljs-title,.vhdl .hljs-literal{color:#268bd2}.hljs-attribute,.hljs-class .hljs-title,.hljs-constant,.hljs-link_reference,.hljs-parent,.hljs-type,.hljs-variable,.lisp .hljs-body,.smalltalk .hljs-number{color:#b58900}.css .hljs-pseudo,.diff .hljs-change,.hljs-attr_selector,.hljs-cdata,.hljs-header,.hljs-pragma,.hljs-preprocessor,.hljs-preprocessor .hljs-keyword,.hljs-shebang,.hljs-special,.hljs-subst,.hljs-symbol,.hljs-symbol .hljs-string{color:#cb4b16}.hljs-deletion,.hljs-important{color:#dc322f}.hljs-link_label{color:#6c71c4}.tex .hljs-formula{background:#eee8d5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Menu_Button .MathJax_Hover_Arrow{position:absolute;cursor:pointer;display:inline-block;border:2px solid #AAA;border-radius:4px;-webkit-border-radius:4px;-moz-border-radius:4px;-khtml-border-radius:4px;font-family:'Courier New',Courier;font-size:9px;color:#F0F0F0}.MathJax_Menu_Button .MathJax_Hover_Arrow span{display:block;background-color:#AAA;border:1px solid;border-radius:3px;line-height:0;padding:4px}.MathJax_Hover_Arrow:hover{color:#fff!important;border:2px solid #CCC!important}.MathJax_Hover_Arrow:hover span{background-color:#CCC!important}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_About.MathJax_MousePost{outline:0}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:5px 0;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;-khtml-border-radius:5px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:1px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;padding-top:.25em;color:#666;font-size:.75em}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:.7em}.MathJax_MenuRadioCheck.RTL{right:.7em;left:auto}.MathJax_MenuLabel{padding:1px 2em 3px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #DDD;margin:4px 3px}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:#606872;color:#fff}.MathJax_MenuDisabled:focus,.MathJax_MenuLabel:focus{background-color:#E8E8E8}.MathJax_ContextMenu .MathJax_MenuItem:focus,.MathJax_ContextMenu:focus{outline:0}#MathJax_AboutClose{top:.2em;right:.2em}.MathJax_Menu .MathJax_MenuClose{top:-10px;left:-10px}.MathJax_MenuClose{position:absolute;cursor:pointer;display:inline-block;border:2px solid #AAA;border-radius:18px;-webkit-border-radius:18px;-moz-border-radius:18px;-khtml-border-radius:18px;font-family:'Courier New',Courier;font-size:24px;color:#F0F0F0}.MathJax_MenuClose span{display:block;background-color:#AAA;border:1.5px solid;border-radius:18px;-webkit-border-radius:18px;-moz-border-radius:18px;-khtml-border-radius:18px;line-height:0;padding:8px 0 6px}.MathJax_MenuClose:hover{color:#fff!important;border:2px solid #CCC!important}.MathJax_MenuClose:hover span{background-color:#CCC!important}.MathJax_MenuClose:hover:focus{outline:0}.MathJax_Preview .MJXf-math{color:inherit!important}.MJX_Assistive_MathML{position:absolute!important;top:0;left:0;clip:rect(1px,1px,1px,1px);padding:1px 0 0!important;border:0!important;height:1px!important;width:1px!important;overflow:hidden!important;display:block!important;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.MJX_Assistive_MathML.MJX_Assistive_MathML_Block{width:100%!important}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1em;bottom:1.5em;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}.MJXp-script{font-size:.8em}.MJXp-right{-webkit-transform-origin:right;-moz-transform-origin:right;-ms-transform-origin:right;-o-transform-origin:right;transform-origin:right}.MJXp-bold{font-weight:700}.MJXp-italic{font-style:italic}.MJXp-scr{font-family:MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}.MJXp-frak{font-family:MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}.MJXp-sf{font-family:MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}.MJXp-cal{font-family:MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}.MJXp-mono{font-family:MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}.MJXp-largeop{font-size:150%}.MJXp-largeop.MJXp-int{vertical-align:-.2em}.MJXp-math{display:inline-block;line-height:1.2;text-indent:0;font-family:'Times New Roman',Times,STIXGeneral,serif;white-space:nowrap;border-collapse:collapse}.MJXp-display{display:block;text-align:center;margin:1em 0}.MJXp-math span{display:inline-block}.MJXp-box{display:block!important;text-align:center}.MJXp-box:after{content:" "}.MJXp-rule{display:block!important;margin-top:.1em}.MJXp-char{display:block!important}.MJXp-mo{margin:0 .15em}.MJXp-mfrac{margin:0 .125em;vertical-align:.25em}.MJXp-denom{display:inline-table!important;width:100%}.MJXp-denom>*{display:table-row!important}.MJXp-surd{vertical-align:top}.MJXp-surd>*{display:block!important}.MJXp-script-box>*{display:table!important;height:50%}.MJXp-script-box>*>*{display:table-cell!important;vertical-align:top}.MJXp-script-box>:last-child>*{vertical-align:bottom}.MJXp-script-box>*>*>*{display:block!important}.MJXp-mphantom{visibility:hidden}.MJXp-munderover{display:inline-table!important}.MJXp-over{display:inline-block!important;text-align:center}.MJXp-over>*{display:block!important}.MJXp-munderover>*{display:table-row!important}.MJXp-mtable{vertical-align:.25em;margin:0 .125em}.MJXp-mtable>*{display:inline-table!important;vertical-align:middle}.MJXp-mtr{display:table-row!important}.MJXp-mtd{display:table-cell!important;text-align:center;padding:.5em 0 0 .5em}.MJXp-mtr>.MJXp-mtd:first-child{padding-left:0}.MJXp-mtr:first-child>.MJXp-mtd{padding-top:0}.MJXp-mlabeledtr{display:table-row!important}.MJXp-mlabeledtr>.MJXp-mtd:first-child{padding-left:0}.MJXp-mlabeledtr:first-child>.MJXp-mtd{padding-top:0}.MJXp-merror{background-color:#FF8;color:#C00;border:1px solid #C00;padding:1px 3px;font-style:normal;font-size:90%}.MJXp-scale0{-webkit-transform:scaleX(0);-moz-transform:scaleX(0);-ms-transform:scaleX(0);-o-transform:scaleX(0);transform:scaleX(0)}.MJXp-scale1{-webkit-transform:scaleX(.1);-moz-transform:scaleX(.1);-ms-transform:scaleX(.1);-o-transform:scaleX(.1);transform:scaleX(.1)}.MJXp-scale2{-webkit-transform:scaleX(.2);-moz-transform:scaleX(.2);-ms-transform:scaleX(.2);-o-transform:scaleX(.2);transform:scaleX(.2)}.MJXp-scale3{-webkit-transform:scaleX(.3);-moz-transform:scaleX(.3);-ms-transform:scaleX(.3);-o-transform:scaleX(.3);transform:scaleX(.3)}.MJXp-scale4{-webkit-transform:scaleX(.4);-moz-transform:scaleX(.4);-ms-transform:scaleX(.4);-o-transform:scaleX(.4);transform:scaleX(.4)}.MJXp-scale5{-webkit-transform:scaleX(.5);-moz-transform:scaleX(.5);-ms-transform:scaleX(.5);-o-transform:scaleX(.5);transform:scaleX(.5)}.MJXp-scale6{-webkit-transform:scaleX(.6);-moz-transform:scaleX(.6);-ms-transform:scaleX(.6);-o-transform:scaleX(.6);transform:scaleX(.6)}.MJXp-scale7{-webkit-transform:scaleX(.7);-moz-transform:scaleX(.7);-ms-transform:scaleX(.7);-o-transform:scaleX(.7);transform:scaleX(.7)}.MJXp-scale8{-webkit-transform:scaleX(.8);-moz-transform:scaleX(.8);-ms-transform:scaleX(.8);-o-transform:scaleX(.8);transform:scaleX(.8)}.MJXp-scale9{-webkit-transform:scaleX(.9);-moz-transform:scaleX(.9);-ms-transform:scaleX(.9);-o-transform:scaleX(.9);transform:scaleX(.9)}.MathJax_PHTML .noError{font-size:90%;text-align:left;color:#000;padding:1px 3px;border:1px solid}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown github">
<h1 id="[swift-combine---ios-13](https://developer.apple.com/documentation/combine)"><a name="[swift-combine---ios-13](https://developer.apple.com/documentation/combine)" href="#[swift-combine---ios-13](https://developer.apple.com/documentation/combine)"></a><a href="https://developer.apple.com/documentation/combine">Swift Combine - iOS 13</a></h1><h2 id="[轉移到-combine](https://medium.com/jeremy-xue-s-blog/swift-轉移到-combine-9b9cc91a0748)"><a name="[轉移到-combine](https://medium.com/jeremy-xue-s-blog/swift-轉移到-combine-9b9cc91a0748)" href="#[轉移到-combine](https://medium.com/jeremy-xue-s-blog/swift-轉移到-combine-9b9cc91a0748)"></a><a href="https://medium.com/jeremy-xue-s-blog/swift-轉移到-combine-9b9cc91a0748">轉移到 Combine</a></h2><ul>
<li>先做一個<a href="https://heckj.github.io/swiftui-notes/index_zh-CN.html">公用程式</a>，印出範例用…</li><li>其實，Combine的功能有很大一部分是用到<a href="https://medium.com/彼得潘的-swift-ios-app-開發問題解答集/成功和失敗二擇一的-result-type-e234c6fccc9c">Result&lt;Value, Error&gt;</a>的設定，成功和失敗二擇一的參數應用…</li><li>Combine也是有所謂的<a href="https://ithelp.ithome.com.tw/articles/10217930">生命週期</a></li><li>當然<a href="https://rxmarbles.com/">RxJS Marbles的彈珠圖</a>也是可以參考的…<pre data-origin="public func example(of description: String, action: () -&amp;gt; Void) {
  print(&quot;\n=== 範例: \(description) ===&quot;)
  action()
}
" class="swift hljs"><span class="hljs-keyword">public</span> <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">example</span><span class="hljs-params">(of description: String, action: <span class="hljs-params">()</span></span></span> -&gt; <span class="hljs-type">Void</span>) {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== 範例: <span class="hljs-subst">\(description)</span> ==="</span>)
  action()
}
</pre>
</li></ul><h2 id="lesson.01---notification-vs-combine"><a name="lesson.01---notification-vs-combine" href="#lesson.01---notification-vs-combine"></a>Lesson.01 - Notification vs Combine</h2><h3 id="[通知---notification](https://www.appcoda.com.tw/notificationcenter/)"><a name="[通知---notification](https://www.appcoda.com.tw/notificationcenter/)" href="#[通知---notification](https://www.appcoda.com.tw/notificationcenter/)"></a><a href="https://www.appcoda.com.tw/notificationcenter/">通知 - Notification</a></h3><ul>
<li>先以一個iOS基本的Notification為基準</li><li><pre data-origin="example(of: &quot;Notification&quot;) {

  let myNotification = Notification.Name(&quot;MyNotification&quot;)
  let center = NotificationCenter.default
  let observer = center.addObserver(forName: myNotification, object: nil, queue: nil) { notification in print(&quot;\(notification.object!)&quot;) }
  let object = &quot;「張君雅小妹妹，恁兜的泡麵已經煮好了，恁阿嬤限妳一分鐘內趕緊回去呷；哪嘸，到時麵若爛去，伊是概不負責！」&quot;

  center.post(name: myNotification, object: object)
  center.removeObserver(observer)
}
" class="swift hljs">example(of: <span class="hljs-string">"Notification"</span>) {

  <span class="hljs-keyword">let</span> myNotification = <span class="hljs-type">Notification</span>.<span class="hljs-type">Name</span>(<span class="hljs-string">"MyNotification"</span>)
  <span class="hljs-keyword">let</span> center = <span class="hljs-type">NotificationCenter</span>.<span class="hljs-keyword">default</span>
  <span class="hljs-keyword">let</span> observer = center.addObserver(forName: myNotification, object: <span class="hljs-literal">nil</span>, queue: <span class="hljs-literal">nil</span>) { notification <span class="hljs-keyword">in</span> <span class="hljs-built_in">print</span>(<span class="hljs-string">"<span class="hljs-subst">\(notification.object!)</span>"</span>) }
  <span class="hljs-keyword">let</span> object = <span class="hljs-string">"「張君雅小妹妹，恁兜的泡麵已經煮好了，恁阿嬤限妳一分鐘內趕緊回去呷；哪嘸，到時麵若爛去，伊是概不負責！」"</span>

  center.post(name: myNotification, object: object)
  center.removeObserver(observer)
}
</pre>
<pre data-origin="=== 範例: Notification ===
「張君雅小妹妹，恁兜的泡麵已經煮好了，恁阿嬤限妳一分鐘內趕緊回去呷；哪嘸，到時麵若爛去，伊是概不負責！」
" class="bash hljs">=== 範例: Notification ===
「張君雅小妹妹，恁兜的泡麵已經煮好了，恁阿嬤限妳一分鐘內趕緊回去呷；哪嘸，到時麵若爛去，伊是概不負責！」
</pre>
</li></ul><h3 id="[發布者---publisher](https://developer.apple.com/documentation/foundation/notificationcenter/publisher)"><a name="[發布者---publisher](https://developer.apple.com/documentation/foundation/notificationcenter/publisher)" href="#[發布者---publisher](https://developer.apple.com/documentation/foundation/notificationcenter/publisher)"></a><a href="https://developer.apple.com/documentation/foundation/notificationcenter/publisher">發布者 - Publisher</a></h3><ul>
<li>可以類比成NotificationCenter.default.post()的功能</li><li>有發布訊息的功能 (單向)</li><li><pre data-origin="example(of: &quot;Publisher&quot;) {

  let myNotification = Notification.Name(&quot;MyNotification&quot;)
  let center = NotificationCenter.default
  let publisher = center.publisher(for: myNotification, object: nil)

  center.post(name: myNotification, object: nil)
}
" class="swift hljs">example(of: <span class="hljs-string">"Publisher"</span>) {

  <span class="hljs-keyword">let</span> myNotification = <span class="hljs-type">Notification</span>.<span class="hljs-type">Name</span>(<span class="hljs-string">"MyNotification"</span>)
  <span class="hljs-keyword">let</span> center = <span class="hljs-type">NotificationCenter</span>.<span class="hljs-keyword">default</span>
  <span class="hljs-keyword">let</span> publisher = center.publisher(<span class="hljs-keyword">for</span>: myNotification, object: <span class="hljs-literal">nil</span>)

  center.post(name: myNotification, object: <span class="hljs-literal">nil</span>)
}
</pre>
</li></ul><h3 id="訂閱者---subscriber"><a name="訂閱者---subscriber" href="#訂閱者---subscriber"></a>訂閱者 - Subscriber</h3><ul>
<li>可以類比成NotificationCenter.default.addObserver()的功能</li><li>有收接訊息的功能 (單向)</li><li><pre data-origin="example(of: &quot;Subscriber&quot;) {

  let myNotification = Notification.Name(&quot;MyNotification&quot;)
  let center = NotificationCenter.default
  let publisher = center.publisher(for: myNotification, object: nil)
  let subscription = publisher.sink { _ in print(&quot;收到從發布者傳來的通知了&quot;) }

  center.post(name: myNotification, object: nil)
  subscription.cancel()
}
" class="swift hljs">example(of: <span class="hljs-string">"Subscriber"</span>) {

  <span class="hljs-keyword">let</span> myNotification = <span class="hljs-type">Notification</span>.<span class="hljs-type">Name</span>(<span class="hljs-string">"MyNotification"</span>)
  <span class="hljs-keyword">let</span> center = <span class="hljs-type">NotificationCenter</span>.<span class="hljs-keyword">default</span>
  <span class="hljs-keyword">let</span> publisher = center.publisher(<span class="hljs-keyword">for</span>: myNotification, object: <span class="hljs-literal">nil</span>)
  <span class="hljs-keyword">let</span> subscription = publisher.sink { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">print</span>(<span class="hljs-string">"收到從發布者傳來的通知了"</span>) }

  center.post(name: myNotification, object: <span class="hljs-literal">nil</span>)
  subscription.cancel()
}
</pre>
</li></ul><h2 id="我心中的combine"><a name="我心中的combine" href="#我心中的combine"></a>我心中的Combine</h2><p><img src="image/Combine.png" alt=""></p><h2 id="初學publisher"><a name="初學publisher" href="#初學publisher"></a>初學Publisher</h2><h3 id="just"><a name="just" href="#just"></a>Just</h3><ul>
<li>使用Combine時，最基本的Publisher</li><li>一個發布者，可由多個訂閱者接收</li><li><pre data-origin="example(of: &quot;Just&quot;) {

  let just = Just(&quot;Hello world!&quot;)

  let subscription_1 = just.sink(
      receiveCompletion: {
          print(&quot;Received completion: &quot;, $0)
      },
      receiveValue: {
          print(&quot;Received value: &quot;, $0)
      })

  let subscription_2 = just.sink(
      receiveCompletion: {
          print(&quot;Received completion (another): &quot;, $0)
      },
      receiveValue: {
          print(&quot;Received value (another): &quot;, $0)
      })

  subscription_1.cancel()
  subscription_2.cancel()
}
" class="swift hljs">example(of: <span class="hljs-string">"Just"</span>) {

  <span class="hljs-keyword">let</span> just = <span class="hljs-type">Just</span>(<span class="hljs-string">"Hello world!"</span>)

  <span class="hljs-keyword">let</span> subscription_1 = just.sink(
      receiveCompletion: {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">"Received completion: "</span>, $<span class="hljs-number">0</span>)
      },
      receiveValue: {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">"Received value: "</span>, $<span class="hljs-number">0</span>)
      })

  <span class="hljs-keyword">let</span> subscription_2 = just.sink(
      receiveCompletion: {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">"Received completion (another): "</span>, $<span class="hljs-number">0</span>)
      },
      receiveValue: {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">"Received value (another): "</span>, $<span class="hljs-number">0</span>)
      })

  subscription_1.cancel()
  subscription_2.cancel()
}
</pre>
<pre data-origin="=== 範例: Just ===
Received value:  Hello world!
Received completion:  finished
Received value (another):  Hello world!
Received completion (another):  finished
" class="bash hljs">=== 範例: Just ===
Received value:  Hello world!
Received completion:  finished
Received value (another):  Hello world!
Received completion (another):  finished
</pre>
</li></ul><h2 id="combine運算子"><a name="combine運算子" href="#combine運算子"></a>Combine運算子</h2><h3 id="[儲存數值---assign(to:on:)](https://developer.apple.com/documentation/combine/just/assign(to:on:))"><a name="[儲存數值---assign(to:on:)](https://developer.apple.com/documentation/combine/just/assign(to:on:))" href="#[儲存數值---assign(to:on:)](https://developer.apple.com/documentation/combine/just/assign(to:on:))"></a><a href="https://developer.apple.com/documentation/combine/just/assign(to:on:)">儲存數值 - assign(to:on:)</a></h3><ul>
<li>萬物都可以轉成Publisher，試著把Array轉成Publisher</li><li>利用assign(to:on:)，把發布者發布的值存到變數裡面</li><li>從didSet()取值 =&gt; <a href="https://davidlinnn.medium.com/swift-4-kvo-筆記-4c89a996e022">KVO - Key-Value Observing</a></li><li><pre data-origin="example(of: &quot;assign(to:on:)&quot;) {

  final class SomeObject {
      var value: String = &quot;&quot; {
          didSet { print(value) }
      }
  }

  let array = [&quot;Hello&quot;, &quot;world!&quot;]
  let object = SomeObject()
  let publisher = array.publisher

  _ = publisher.assign(to: \.value, on: object)
}
" class="swift hljs">example(of: <span class="hljs-string">"assign(to:on:)"</span>) {

  <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeObject</span> </span>{
      <span class="hljs-keyword">var</span> value: <span class="hljs-type">String</span> = <span class="hljs-string">""</span> {
          <span class="hljs-keyword">didSet</span> { <span class="hljs-built_in">print</span>(value) }
      }
  }

  <span class="hljs-keyword">let</span> array = [<span class="hljs-string">"Hello"</span>, <span class="hljs-string">"world!"</span>]
  <span class="hljs-keyword">let</span> object = <span class="hljs-type">SomeObject</span>()
  <span class="hljs-keyword">let</span> publisher = array.publisher

  <span class="hljs-number">_</span> = publisher.assign(to: \.value, on: object)
}
</pre>
<pre data-origin="=== 範例: assign(to:on:) ===
Hello
world!
" class="bash hljs">=== 範例: assign(to:on:) ===
Hello
world!
</pre>
</li></ul><h3 id="[儲存數值---assign(to:)](https://developer.apple.com/documentation/combine/just/assign(to:))"><a name="[儲存數值---assign(to:)](https://developer.apple.com/documentation/combine/just/assign(to:))" href="#[儲存數值---assign(to:)](https://developer.apple.com/documentation/combine/just/assign(to:))"></a><a href="https://developer.apple.com/documentation/combine/just/assign(to:)">儲存數值 - assign(to:)</a></h3><ul>
<li>這是個相當經典的例子</li><li>利用<a href="https://medium.com/彼得潘的-swift-ios-app-開發教室/swiftui-什麼是-published-observableobject-eb950f8295a">@Published</a>，將變數value轉成Publisher，這時候的value就要用$value來處理</li><li>而要存到變數value，就要使用&amp;object來處理</li><li>使用<a href="https://developer.apple.com/documentation/combine/just/sink(receivevalue:)">sink()</a>取值，而不是從數值去取值了</li><li><pre data-origin="example(of: &quot;assign(to:)&quot;) {

  final class SomeObject {
      @Published var value = 0
  }

  let object = SomeObject()
  object.$value.sink { print(&quot;收到的值為: \($0)&quot;) }

  (0..&amp;lt;10).publisher.assign(to: &amp;amp;object.$value)
}
" class="swift hljs">example(of: <span class="hljs-string">"assign(to:)"</span>) {

  <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SomeObject</span> </span>{
      @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> value = <span class="hljs-number">0</span>
  }

  <span class="hljs-keyword">let</span> object = <span class="hljs-type">SomeObject</span>()
  object.$value.sink { <span class="hljs-built_in">print</span>(<span class="hljs-string">"收到的值為: <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) }

  (<span class="hljs-number">0</span>..&lt;<span class="hljs-number">10</span>).publisher.assign(to: &amp;object.$value)
}
</pre>
<pre data-origin="=== 範例: assign(to:) ===
收到的值為: 0
收到的值為: 0
收到的值為: 1
收到的值為: 2
收到的值為: 3
收到的值為: 4
收到的值為: 5
收到的值為: 6
收到的值為: 7
收到的值為: 8
收到的值為: 9
" class="bash hljs">=== 範例: assign(to:) ===
收到的值為: <span class="hljs-number">0</span>
收到的值為: <span class="hljs-number">0</span>
收到的值為: <span class="hljs-number">1</span>
收到的值為: <span class="hljs-number">2</span>
收到的值為: <span class="hljs-number">3</span>
收到的值為: <span class="hljs-number">4</span>
收到的值為: <span class="hljs-number">5</span>
收到的值為: <span class="hljs-number">6</span>
收到的值為: <span class="hljs-number">7</span>
收到的值為: <span class="hljs-number">8</span>
收到的值為: <span class="hljs-number">9</span>
</pre>
</li></ul><h3 id="自訂subscriber"><a name="自訂subscriber" href="#自訂subscriber"></a>自訂Subscriber</h3><ul>
<li>只要使用協定Subscriber就可以自己產生一個自訂Subscriber</li><li>如果使用subscription.request(.max(3)) + return .none，就只會印三個，而且不會結束</li><li>但如果把return .none改成return .unlimited，就只會印全部，而且會結束</li><li><pre data-origin="example(of: &quot;Custom Subscriber&quot;) {

  final class MagazineSubscriber: Subscriber {

      typealias Input = String                                // 雜誌名稱是文字
      typealias Failure = Never                               // 不處理錯誤

      private let maxCount = 3

      private var count = 0
      private var subscription: Subscription?

      func receive(subscription: Subscription) {
          print(subscription)

          self.subscription = subscription                    // 在這裡，你可以保存subscription，並告訴出版社你要接收雜誌
          subscription.request(.unlimited)                    // 請求出版商無限制數量的雜誌
      }

      func receive(_ input: Input) -&amp;gt; Subscribers.Demand {

          print(&quot;Received value&quot;, input, count)               // 在這裡，你可以處理收到的雜誌內容
          count += 1

          if (count &amp;gt;= maxCount) { subscription?.cancel() }   // 它表明訂閱者不再需要額外的項目 (目標到達，取消訂閱)
          return .unlimited                                   // 請求接收更多的雜誌
      }

      func receive(completion: Subscribers.Completion&amp;lt;Never&amp;gt;) {
          print(&quot;Received completion&quot;, completion)
      }
  }

  let magazines = [&quot;ABC互動英語&quot;, &quot;LIVE互動英語&quot;, &quot;CNN互動英語&quot;, &quot;互動日本語&quot;, &quot;跟我一起學日語&quot;, &quot;KOREA韓語學習誌&quot;]

  let publisher = magazines.publisher                         // Array =&amp;gt; Publisher
  let subscriber = MagazineSubscriber()

  publisher.subscribe(subscriber)
}
" class="swift hljs">example(of: <span class="hljs-string">"Custom Subscriber"</span>) {

  <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MagazineSubscriber</span>: <span class="hljs-title">Subscriber</span> </span>{

      <span class="hljs-keyword">typealias</span> <span class="hljs-type">Input</span> = <span class="hljs-type">String</span>                                <span class="hljs-comment">// 雜誌名稱是文字</span>
      <span class="hljs-keyword">typealias</span> <span class="hljs-type">Failure</span> = <span class="hljs-type">Never</span>                               <span class="hljs-comment">// 不處理錯誤</span>

      <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> maxCount = <span class="hljs-number">3</span>

      <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> <span class="hljs-built_in">count</span> = <span class="hljs-number">0</span>
      <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> subscription: <span class="hljs-type">Subscription</span>?

      <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">receive</span><span class="hljs-params">(subscription: Subscription)</span></span> {
          <span class="hljs-built_in">print</span>(subscription)

          <span class="hljs-keyword">self</span>.subscription = subscription                    <span class="hljs-comment">// 在這裡，你可以保存subscription，並告訴出版社你要接收雜誌</span>
          subscription.request(.unlimited)                    <span class="hljs-comment">// 請求出版商無限制數量的雜誌</span>
      }

      <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">receive</span><span class="hljs-params">(<span class="hljs-number">_</span> input: Input)</span></span> -&gt; <span class="hljs-type">Subscribers</span>.<span class="hljs-type">Demand</span> {

          <span class="hljs-built_in">print</span>(<span class="hljs-string">"Received value"</span>, input, <span class="hljs-built_in">count</span>)               <span class="hljs-comment">// 在這裡，你可以處理收到的雜誌內容</span>
          <span class="hljs-built_in">count</span> += <span class="hljs-number">1</span>

          <span class="hljs-keyword">if</span> (<span class="hljs-built_in">count</span> &gt;= maxCount) { subscription?.cancel() }   <span class="hljs-comment">// 它表明訂閱者不再需要額外的項目 (目標到達，取消訂閱)</span>
          <span class="hljs-keyword">return</span> .unlimited                                   <span class="hljs-comment">// 請求接收更多的雜誌</span>
      }

      <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">receive</span><span class="hljs-params">(completion: Subscribers.Completion&lt;Never&gt;)</span></span> {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">"Received completion"</span>, completion)
      }
  }

  <span class="hljs-keyword">let</span> magazines = [<span class="hljs-string">"ABC互動英語"</span>, <span class="hljs-string">"LIVE互動英語"</span>, <span class="hljs-string">"CNN互動英語"</span>, <span class="hljs-string">"互動日本語"</span>, <span class="hljs-string">"跟我一起學日語"</span>, <span class="hljs-string">"KOREA韓語學習誌"</span>]

  <span class="hljs-keyword">let</span> publisher = magazines.publisher                         <span class="hljs-comment">// Array =&gt; Publisher</span>
  <span class="hljs-keyword">let</span> subscriber = <span class="hljs-type">MagazineSubscriber</span>()

  publisher.subscribe(subscriber)
}
</pre>
<pre data-origin="=== 範例: Custom Subscriber ===
[&quot;ABC互動英語&quot;, &quot;LIVE互動英語&quot;, &quot;CNN互動英語&quot;, &quot;互動日本語&quot;, &quot;跟我一起學日語&quot;, &quot;KOREA韓語學習誌&quot;]
Received value ABC互動英語 0
Received value LIVE互動英語 1
Received value CNN互動英語 2
" class="bash hljs">=== 範例: Custom Subscriber ===
[<span class="hljs-string">"ABC互動英語"</span>, <span class="hljs-string">"LIVE互動英語"</span>, <span class="hljs-string">"CNN互動英語"</span>, <span class="hljs-string">"互動日本語"</span>, <span class="hljs-string">"跟我一起學日語"</span>, <span class="hljs-string">"KOREA韓語學習誌"</span>]
Received value ABC互動英語 <span class="hljs-number">0</span>
Received value LIVE互動英語 <span class="hljs-number">1</span>
Received value CNN互動英語 <span class="hljs-number">2</span>
</pre>
</li></ul><h2 id="publisher"><a name="publisher" href="#publisher"></a>Publisher</h2><h3 id="[future---非同步publisher](https://developer.apple.com/documentation/combine/future)"><a name="[future---非同步publisher](https://developer.apple.com/documentation/combine/future)" href="#[future---非同步publisher](https://developer.apple.com/documentation/combine/future)"></a><a href="https://developer.apple.com/documentation/combine/future">Future - 非同步Publisher</a></h3><ul>
<li>聽名字就知道，接收未來資料與事件<a href="https://www.jianshu.com/p/c5dbc67fcfcb">非同步</a>的Publisher</li><li>在這裡我們讓它停止3秒，再顯示值</li><li><pre data-origin="var subscriptions = Set&amp;lt;AnyCancellable&amp;gt;()
example(of: &quot;Future&quot;) {

  func futureIncrement(integer: Int, afterDelay delay: UInt32) -&amp;gt; Future&amp;lt;Int, Never&amp;gt; {

      Future&amp;lt;Int, Never&amp;gt; { promise in
          print(&quot;Original =&amp;gt; \(integer)&quot;)
          sleep(delay)
          promise(.success(integer + 1))
      }
  }

  let future = futureIncrement(integer: 1, afterDelay: 3)

  future
      .sink(receiveCompletion: { print(&quot;Completion =&amp;gt; \($0)&quot;) }, receiveValue: { print(&quot;Value =&amp;gt; \($0)&quot;) })
      .store(in: &amp;amp;subscriptions)

  future
      .sink(receiveCompletion: { print(&quot;Completion =&amp;gt; \($0)&quot;) }, receiveValue: { print(&quot;Value =&amp;gt; \($0)&quot;) })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs"><span class="hljs-keyword">var</span> subscriptions = <span class="hljs-type">Set</span>&lt;<span class="hljs-type">AnyCancellable</span>&gt;()
example(of: <span class="hljs-string">"Future"</span>) {

  <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">futureIncrement</span><span class="hljs-params">(integer: Int, afterDelay delay: UInt32)</span></span> -&gt; <span class="hljs-type">Future</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt; {

      <span class="hljs-type">Future</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt; { promise <span class="hljs-keyword">in</span>
          <span class="hljs-built_in">print</span>(<span class="hljs-string">"Original =&gt; <span class="hljs-subst">\(integer)</span>"</span>)
          sleep(delay)
          promise(.success(integer + <span class="hljs-number">1</span>))
      }
  }

  <span class="hljs-keyword">let</span> future = futureIncrement(integer: <span class="hljs-number">1</span>, afterDelay: <span class="hljs-number">3</span>)

  future
      .sink(receiveCompletion: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Completion =&gt; <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) }, receiveValue: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Value =&gt; <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  future
      .sink(receiveCompletion: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Completion =&gt; <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) }, receiveValue: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Value =&gt; <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: Future ===
Original =&amp;gt; 1
Value =&amp;gt; 2
Completion =&amp;gt; finished
Value =&amp;gt; 2
Completion =&amp;gt; finished
" class="bash hljs">=== 範例: Future ===
Original =&gt; <span class="hljs-number">1</span>
Value =&gt; <span class="hljs-number">2</span>
Completion =&gt; finished
Value =&gt; <span class="hljs-number">2</span>
Completion =&gt; finished
</pre>
</li></ul><h2 id="[subject---publisher-延展類](https://louyu.cc/articles/ios-swift/2021/03/?p=2857/)"><a name="[subject---publisher-延展類](https://louyu.cc/articles/ios-swift/2021/03/?p=2857/)" href="#[subject---publisher-延展類](https://louyu.cc/articles/ios-swift/2021/03/?p=2857/)"></a><a href="https://louyu.cc/articles/ios-swift/2021/03/?p=2857/">Subject - Publisher 延展類</a></h2><h3 id="[passthroughsubject](https://ithelp.ithome.com.tw/articles/10219418)"><a name="[passthroughsubject](https://ithelp.ithome.com.tw/articles/10219418)" href="#[passthroughsubject](https://ithelp.ithome.com.tw/articles/10219418)"></a><a href="https://ithelp.ithome.com.tw/articles/10219418">PassthroughSubject</a></h3><ul>
<li>與之前我們討論的 Publisher 不同的是，Subject 的最大特點就是可以手動傳送資料</li><li><pre data-origin="example(of: &quot;PassthroughSubject&quot;) {

  enum MyError: Error {
      case test
  }

  final class StringSubscriber: Subscriber {

      typealias Input = String
      typealias Failure = MyError

      func receive(subscription: Subscription) {
          subscription.request(.max(2))
      }

      func receive(_ input: String) -&amp;gt; Subscribers.Demand {
          print(&quot;Received value (input): &quot;, input)
          return input == &quot;World&quot; ? .max(1) : .none
      }

      func receive(completion: Subscribers.Completion&amp;lt;MyError&amp;gt;) {
          print(&quot;Received completion (input): &quot;, completion)
      }
  }

  let subscriber = StringSubscriber()
  let subject = PassthroughSubject&amp;lt;String, MyError&amp;gt;()

  subject.subscribe(subscriber)

  let subscription = subject
      .sink(
          receiveCompletion: { completion in print(&quot;Received completion (sink): &quot;, completion) },
          receiveValue: { value in print(&quot;Received value (sink): &quot;, value) }
      )

  subject.send(&quot;Hello&quot;)
  subject.send(&quot;World&quot;)

  subscription.cancel()

  subject.send(&quot;Still there?&quot;)

  // subject.send(completion: .failure(MyError.test))
  subject.send(completion: .finished)

  subject.send(&quot;How about another one?&quot;)
}
" class="swift hljs">example(of: <span class="hljs-string">"PassthroughSubject"</span>) {

  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">MyError</span>: <span class="hljs-title">Error</span> </span>{
      <span class="hljs-keyword">case</span> test
  }

  <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringSubscriber</span>: <span class="hljs-title">Subscriber</span> </span>{

      <span class="hljs-keyword">typealias</span> <span class="hljs-type">Input</span> = <span class="hljs-type">String</span>
      <span class="hljs-keyword">typealias</span> <span class="hljs-type">Failure</span> = <span class="hljs-type">MyError</span>

      <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">receive</span><span class="hljs-params">(subscription: Subscription)</span></span> {
          subscription.request(.<span class="hljs-built_in">max</span>(<span class="hljs-number">2</span>))
      }

      <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">receive</span><span class="hljs-params">(<span class="hljs-number">_</span> input: String)</span></span> -&gt; <span class="hljs-type">Subscribers</span>.<span class="hljs-type">Demand</span> {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">"Received value (input): "</span>, input)
          <span class="hljs-keyword">return</span> input == <span class="hljs-string">"World"</span> ? .<span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>) : .<span class="hljs-keyword">none</span>
      }

      <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">receive</span><span class="hljs-params">(completion: Subscribers.Completion&lt;MyError&gt;)</span></span> {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">"Received completion (input): "</span>, completion)
      }
  }

  <span class="hljs-keyword">let</span> subscriber = <span class="hljs-type">StringSubscriber</span>()
  <span class="hljs-keyword">let</span> subject = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">MyError</span>&gt;()

  subject.subscribe(subscriber)

  <span class="hljs-keyword">let</span> subscription = subject
      .sink(
          receiveCompletion: { completion <span class="hljs-keyword">in</span> <span class="hljs-built_in">print</span>(<span class="hljs-string">"Received completion (sink): "</span>, completion) },
          receiveValue: { value <span class="hljs-keyword">in</span> <span class="hljs-built_in">print</span>(<span class="hljs-string">"Received value (sink): "</span>, value) }
      )

  subject.send(<span class="hljs-string">"Hello"</span>)
  subject.send(<span class="hljs-string">"World"</span>)

  subscription.cancel()

  subject.send(<span class="hljs-string">"Still there?"</span>)

  <span class="hljs-comment">// subject.send(completion: .failure(MyError.test))</span>
  subject.send(completion: .finished)

  subject.send(<span class="hljs-string">"How about another one?"</span>)
}
</pre>
<pre data-origin="=== 範例: PassthroughSubject ===
Received value (sink):  Hello
Received value (input):  Hello
Received value (sink):  World
Received value (input):  World
Received value (input):  Still there?
Received completion:  finished
" class="bash hljs">=== 範例: PassthroughSubject ===
Received value (sink):  Hello
Received value (input):  Hello
Received value (sink):  World
Received value (input):  World
Received value (input):  Still there?
Received completion:  finished
</pre>
</li></ul><h3 id="[currentvaluesubject---publisher-延展類](https://www.avanderlee.com/combine/passthroughsubject-currentvaluesubject-explained/)"><a name="[currentvaluesubject---publisher-延展類](https://www.avanderlee.com/combine/passthroughsubject-currentvaluesubject-explained/)" href="#[currentvaluesubject---publisher-延展類](https://www.avanderlee.com/combine/passthroughsubject-currentvaluesubject-explained/)"></a><a href="https://www.avanderlee.com/combine/passthroughsubject-currentvaluesubject-explained/">CurrentValueSubject - Publisher 延展類</a></h3><ul>
<li>與 PassthroughSubject 不同，CurrentValueSubject 會保留一個最後的資料，並在被訂閱時將這個資料傳送給下游的 Publisher 或 Subscriber。</li><li><pre data-origin="example(of: &quot;CurrentValueSubject&quot;) {

  let subject = CurrentValueSubject&amp;lt;Int, Never&amp;gt;(0)    // 設定初值

  subject
      .print()
      .sink(receiveValue: { print(&quot;First subscription: \($0)&quot;) })
      .store(in: &amp;amp;subscriptions)

  subject.send(1)
  subject.send(2)

  print(subject.value)

  subject.value = 3
  print(subject.value)

  subject
      .print()
      .sink(receiveValue: { print(&quot;Second subscription:&quot;, $0) })
      .store(in: &amp;amp;subscriptions)

  subject.send(completion: .finished)
}
" class="swift hljs">example(of: <span class="hljs-string">"CurrentValueSubject"</span>) {

  <span class="hljs-keyword">let</span> subject = <span class="hljs-type">CurrentValueSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;(<span class="hljs-number">0</span>)    <span class="hljs-comment">// 設定初值</span>

  subject
      .<span class="hljs-built_in">print</span>()
      .sink(receiveValue: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"First subscription: <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  subject.send(<span class="hljs-number">1</span>)
  subject.send(<span class="hljs-number">2</span>)

  <span class="hljs-built_in">print</span>(subject.value)

  subject.value = <span class="hljs-number">3</span>
  <span class="hljs-built_in">print</span>(subject.value)

  subject
      .<span class="hljs-built_in">print</span>()
      .sink(receiveValue: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Second subscription:"</span>, $<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  subject.send(completion: .finished)
}
</pre>
<pre data-origin="=== 範例: CurrentValueSubject ===
receive subscription: (CurrentValueSubject)
request unlimited
receive value: (0)
First subscription: 0
receive value: (1)
First subscription: 1
receive value: (2)
First subscription: 2
2
receive value: (3)
First subscription: 3
3
receive subscription: (CurrentValueSubject)
request unlimited
receive value: (3)
Second subscription: 3
receive finished
receive finished
" class="bash hljs">=== 範例: CurrentValueSubject ===
receive subscription: (CurrentValueSubject)
request unlimited
receive value: (<span class="hljs-number">0</span>)
First subscription: <span class="hljs-number">0</span>
receive value: (<span class="hljs-number">1</span>)
First subscription: <span class="hljs-number">1</span>
receive value: (<span class="hljs-number">2</span>)
First subscription: <span class="hljs-number">2</span>
<span class="hljs-number">2</span>
receive value: (<span class="hljs-number">3</span>)
First subscription: <span class="hljs-number">3</span>
<span class="hljs-number">3</span>
receive subscription: (CurrentValueSubject)
request unlimited
receive value: (<span class="hljs-number">3</span>)
Second subscription: <span class="hljs-number">3</span>
receive finished
receive finished
</pre>
</li></ul><h3 id="[自動校正demand](https://developer.apple.com/documentation/combine/subscribers/demand)"><a name="[自動校正demand](https://developer.apple.com/documentation/combine/subscribers/demand)" href="#[自動校正demand](https://developer.apple.com/documentation/combine/subscribers/demand)"></a><a href="https://developer.apple.com/documentation/combine/subscribers/demand">自動校正Demand</a></h3><ul>
<li>這裡是自動根據輸入的值，去改變Subscribers.Demand</li><li><pre data-origin="example(of: &quot;Dynamically adjusting Demand&quot;) {

  final class IntSubscriber: Subscriber {

      typealias Input = Int
      typealias Failure = Never

      func receive(subscription: Subscription) {
          subscription.request(.max(3))   // .max(3): 初始值
      }

      func receive(_ input: Int) -&amp;gt; Subscribers.Demand {

          print(&quot;Received value&quot;, input)

          switch input {                  // 累加的 =&amp;gt;
          case 1: return .max(2)          // .max(3) + .max(2) = .max(4)
          case 3: return .max(1)          // .max(4) + .max(1) = .max(5)
          default: return .none           // .max(5)
          }
      }

      func receive(completion: Subscribers.Completion&amp;lt;Never&amp;gt;) {
          print(&quot;Received completion: &quot;, completion)
      }
  }

  let subscriber = IntSubscriber()
  let subject = PassthroughSubject&amp;lt;Int, Never&amp;gt;()

  subject.subscribe(subscriber)

  (1...10).forEach { subject.send($0) }
}
" class="swift hljs">example(of: <span class="hljs-string">"Dynamically adjusting Demand"</span>) {

  <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IntSubscriber</span>: <span class="hljs-title">Subscriber</span> </span>{

      <span class="hljs-keyword">typealias</span> <span class="hljs-type">Input</span> = <span class="hljs-type">Int</span>
      <span class="hljs-keyword">typealias</span> <span class="hljs-type">Failure</span> = <span class="hljs-type">Never</span>

      <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">receive</span><span class="hljs-params">(subscription: Subscription)</span></span> {
          subscription.request(.<span class="hljs-built_in">max</span>(<span class="hljs-number">3</span>))   <span class="hljs-comment">// .max(3): 初始值</span>
      }

      <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">receive</span><span class="hljs-params">(<span class="hljs-number">_</span> input: Int)</span></span> -&gt; <span class="hljs-type">Subscribers</span>.<span class="hljs-type">Demand</span> {

          <span class="hljs-built_in">print</span>(<span class="hljs-string">"Received value"</span>, input)

          <span class="hljs-keyword">switch</span> input {                  <span class="hljs-comment">// 累加的 =&gt;</span>
          <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> .<span class="hljs-built_in">max</span>(<span class="hljs-number">2</span>)          <span class="hljs-comment">// .max(3) + .max(2) = .max(4)</span>
          <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">return</span> .<span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>)          <span class="hljs-comment">// .max(4) + .max(1) = .max(5)</span>
          <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> .<span class="hljs-keyword">none</span>           <span class="hljs-comment">// .max(5)</span>
          }
      }

      <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">receive</span><span class="hljs-params">(completion: Subscribers.Completion&lt;Never&gt;)</span></span> {
          <span class="hljs-built_in">print</span>(<span class="hljs-string">"Received completion: "</span>, completion)
      }
  }

  <span class="hljs-keyword">let</span> subscriber = <span class="hljs-type">IntSubscriber</span>()
  <span class="hljs-keyword">let</span> subject = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()

  subject.subscribe(subscriber)

  (<span class="hljs-number">1</span>...<span class="hljs-number">10</span>).forEach { subject.send($<span class="hljs-number">0</span>) }
}
</pre>
<pre data-origin="=== 範例: Dynamically adjusting Demand ===
Received value 1
Received value 2
Received value 3
Received value 4
Received value 5
Received value 6
" class="bash hljs">=== 範例: Dynamically adjusting Demand ===
Received value <span class="hljs-number">1</span>
Received value <span class="hljs-number">2</span>
Received value <span class="hljs-number">3</span>
Received value <span class="hljs-number">4</span>
Received value <span class="hljs-number">5</span>
Received value <span class="hljs-number">6</span>
</pre>
</li></ul><h3 id="[erasetoanypublisher()](https://developer.apple.com/documentation/combine/publisher/erasetoanypublisher(;))"><a name="[erasetoanypublisher()](https://developer.apple.com/documentation/combine/publisher/erasetoanypublisher(;))" href="#[erasetoanypublisher()](https://developer.apple.com/documentation/combine/publisher/erasetoanypublisher(;))"></a><a href="https://developer.apple.com/documentation/combine/publisher/erasetoanypublisher(;&amp;#41">eraseToAnyPublisher()</a></h3><ul>
<li>轉成AnyPublisher</li><li>讓Publisher的類型<a href="https://ithelp.ithome.com.tw/articles/10221967">簡單化</a></li><li><pre data-origin="example(of: &quot;Type erasure&quot;) {

  let subject = PassthroughSubject&amp;lt;Int, Never&amp;gt;()  // PassthroughSubject&amp;lt;Int, Never&amp;gt;
  let publisher = subject.eraseToAnyPublisher()   // PassthroughSubject&amp;lt;Int, Never&amp;gt; =&amp;gt; AnyPublisher&amp;lt;Int, Never&amp;gt;

  publisher
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)

  subject.send(0)
  // publisher.send(1)    // ∵ 轉成了AnyPublisher&amp;lt;Int, Never&amp;gt; ∴ 沒有send()
}
" class="swift hljs">example(of: <span class="hljs-string">"Type erasure"</span>) {

  <span class="hljs-keyword">let</span> subject = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()  <span class="hljs-comment">// PassthroughSubject&lt;Int, Never&gt;</span>
  <span class="hljs-keyword">let</span> publisher = subject.eraseToAnyPublisher()   <span class="hljs-comment">// PassthroughSubject&lt;Int, Never&gt; =&gt; AnyPublisher&lt;Int, Never&gt;</span>

  publisher
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  subject.send(<span class="hljs-number">0</span>)
  <span class="hljs-comment">// publisher.send(1)    // ∵ 轉成了AnyPublisher&lt;Int, Never&gt; ∴ 沒有send()</span>
}
</pre>
<pre data-origin="=== 範例: Type erasure ===
0
" class="bash hljs">=== 範例: Type erasure ===
<span class="hljs-number">0</span>
</pre>
</li></ul><h3 id="async-/-await"><a name="async-/-await" href="#async-/-await"></a>async / await</h3><ul>
<li>非同步使用的範例</li><li><pre data-origin="example(of: &quot;async / await&quot;) {

  let subject = CurrentValueSubject&amp;lt;Int, Never&amp;gt;(0)    // 設定初值 = 0

  Task {
      for await element in subject.values { print(&quot;Element: \(element)&quot;) }
      print(&quot;Completed.&quot;)
  }

  sleep(2)
  subject.send(1)     // 可以使用在非同步之上
  sleep(2)
  subject.send(2)
  sleep(2)
  subject.send(3)

  subject.send(completion: .finished)
}
" class="swift hljs">example(of: <span class="hljs-string">"async / await"</span>) {

  <span class="hljs-keyword">let</span> subject = <span class="hljs-type">CurrentValueSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;(<span class="hljs-number">0</span>)    <span class="hljs-comment">// 設定初值 = 0</span>

  <span class="hljs-type">Task</span> {
      <span class="hljs-keyword">for</span> await element <span class="hljs-keyword">in</span> subject.values { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Element: <span class="hljs-subst">\(element)</span>"</span>) }
      <span class="hljs-built_in">print</span>(<span class="hljs-string">"Completed."</span>)
  }

  sleep(<span class="hljs-number">2</span>)
  subject.send(<span class="hljs-number">1</span>)     <span class="hljs-comment">// 可以使用在非同步之上</span>
  sleep(<span class="hljs-number">2</span>)
  subject.send(<span class="hljs-number">2</span>)
  sleep(<span class="hljs-number">2</span>)
  subject.send(<span class="hljs-number">3</span>)

  subject.send(completion: .finished)
}
</pre>
<pre data-origin="=== 範例: async / await ===
Element: 0
Element: 1
Element: 2
Element: 3
Completed.
" class="bash hljs">=== 範例: async / await ===
Element: <span class="hljs-number">0</span>
Element: <span class="hljs-number">1</span>
Element: <span class="hljs-number">2</span>
Element: <span class="hljs-number">3</span>
Completed.
</pre>
</li></ul><h2 id="lesson.02---operators也是publisher"><a name="lesson.02---operators也是publisher" href="#lesson.02---operators也是publisher"></a>Lesson.02 - Operators也是Publisher</h2><h3 id="[collect()](https://juejin.cn/post/7017265258263740424)"><a name="[collect()](https://juejin.cn/post/7017265258263740424)" href="#[collect()](https://juejin.cn/post/7017265258263740424)"></a><a href="https://juejin.cn/post/7017265258263740424">collect()</a></h3><ul>
<li><p>將單一值做分組…</p>
<pre data-origin="example(of: &quot;collect&quot;) {

  let array = [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;]

  array.publisher
      .collect(2)     // 2個2個一組，預設是1組；如果不加它的話，就是一個一個單獨輸出
      .sink(
          receiveCompletion: { print($0) },
          receiveValue: { print($0) }
      )
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"collect"</span>) {

  <span class="hljs-keyword">let</span> array = [<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>, <span class="hljs-string">"E"</span>]

  array.publisher
      .collect(<span class="hljs-number">2</span>)     <span class="hljs-comment">// 2個2個一組，預設是1組；如果不加它的話，就是一個一個單獨輸出</span>
      .sink(
          receiveCompletion: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) },
          receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) }
      )
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: collect ===
[&quot;A&quot;, &quot;B&quot;]
[&quot;C&quot;, &quot;D&quot;]
[&quot;E&quot;]
finished
" class="bash hljs">=== 範例: collect ===
[<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>]
[<span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>]
[<span class="hljs-string">"E"</span>]
finished
</pre>
</li></ul><h3 id="[map()](https://cocoacasts.com/combine-essentials-how-to-use-combine-map-and-compactmap-operators)"><a name="[map()](https://cocoacasts.com/combine-essentials-how-to-use-combine-map-and-compactmap-operators)" href="#[map()](https://cocoacasts.com/combine-essentials-how-to-use-combine-map-and-compactmap-operators)"></a><a href="https://cocoacasts.com/combine-essentials-how-to-use-combine-map-and-compactmap-operators">map()</a></h3><ul>
<li><p>其實這個跟swift的<a href="https://franksios.medium.com/swift3-高階函數-higher-order-function-a97cf4577a11">高階函數 - map</a>很像，把值一個個處理，然後轉成另一種數值…</p>
<pre data-origin="example(of: &quot;map&quot;) {

  let array = [123, 4, 56]
  let formatter = NumberFormatter()

  formatter.numberStyle = .spellOut

  array.publisher
      .map({ value in
          formatter.string(for: NSNumber(integerLiteral: value)) ?? &quot;&quot;
      })
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"map"</span>) {

  <span class="hljs-keyword">let</span> array = [<span class="hljs-number">123</span>, <span class="hljs-number">4</span>, <span class="hljs-number">56</span>]
  <span class="hljs-keyword">let</span> formatter = <span class="hljs-type">NumberFormatter</span>()

  formatter.numberStyle = .spellOut

  array.publisher
      .<span class="hljs-built_in">map</span>({ value <span class="hljs-keyword">in</span>
          formatter.string(<span class="hljs-keyword">for</span>: <span class="hljs-type">NSNumber</span>(integerLiteral: value)) ?? <span class="hljs-string">""</span>
      })
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: map ===
one hundred twenty-three
four
fifty-six
" class="bash hljs">=== 範例: map ===
one hundred twenty-three
four
fifty-six
</pre>
</li><li><p>使用座標(x,y)當成map()的範例</p>
<pre data-origin="example(of: &quot;mapping key paths&quot;) {

  let publisher = PassthroughSubject&amp;lt;Coordinate, Never&amp;gt;()

  publisher
      .map(\.x, \.y)      // 也可以這樣取值 (Coordinate.x / Coordinate.y)
      .sink(receiveValue: { x, y in
          guard let quadrant = quadrantOf(x: x, y: y) else { print(&quot;座標在 (\(x), \(y)) 在軸上&quot;); return }
          print(&quot;座標在 (\(x), \(y)) 第\(quadrant)象限&quot;)
      })
      .store(in: &amp;amp;subscriptions)

  publisher.send(Coordinate(x: 10, y: -8))
  publisher.send(Coordinate(x: 0, y: 5))
}
" class="swift hljs">example(of: <span class="hljs-string">"mapping key paths"</span>) {

  <span class="hljs-keyword">let</span> publisher = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Coordinate</span>, <span class="hljs-type">Never</span>&gt;()

  publisher
      .<span class="hljs-built_in">map</span>(\.x, \.y)      <span class="hljs-comment">// 也可以這樣取值 (Coordinate.x / Coordinate.y)</span>
      .sink(receiveValue: { x, y <span class="hljs-keyword">in</span>
          <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> quadrant = quadrantOf(x: x, y: y) <span class="hljs-keyword">else</span> { <span class="hljs-built_in">print</span>(<span class="hljs-string">"座標在 (<span class="hljs-subst">\(x)</span>, <span class="hljs-subst">\(y)</span>) 在軸上"</span>); <span class="hljs-keyword">return</span> }
          <span class="hljs-built_in">print</span>(<span class="hljs-string">"座標在 (<span class="hljs-subst">\(x)</span>, <span class="hljs-subst">\(y)</span>) 第<span class="hljs-subst">\(quadrant)</span>象限"</span>)
      })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  publisher.send(<span class="hljs-type">Coordinate</span>(x: <span class="hljs-number">10</span>, y: -<span class="hljs-number">8</span>))
  publisher.send(<span class="hljs-type">Coordinate</span>(x: <span class="hljs-number">0</span>, y: <span class="hljs-number">5</span>))
}
</pre>
<pre data-origin="=== 範例: mapping key paths ===
座標在 (10, -8) 第4象限
座標在 (0, 5) 在軸上
" class="bash hljs">=== 範例: mapping key paths ===
座標在 (<span class="hljs-number">10</span>, -<span class="hljs-number">8</span>) 第<span class="hljs-number">4</span>象限
座標在 (<span class="hljs-number">0</span>, <span class="hljs-number">5</span>) 在軸上
</pre>
</li></ul><h3 id="[trymap()](https://juejin.cn/post/7023214404007264263)"><a name="[trymap()](https://juejin.cn/post/7023214404007264263)" href="#[trymap()](https://juejin.cn/post/7023214404007264263)"></a><a href="https://juejin.cn/post/7023214404007264263">tryMap()</a></h3><ul>
<li><p>有錯誤處理的map</p>
<pre data-origin="example(of: &quot;tryMap&quot;) {

  Just(&quot;資料夾名稱不存在!!!&quot;)
      .tryMap { try FileManager.default.contentsOfDirectory(atPath: $0) }
      .sink(
          receiveCompletion: { print(&quot;Completion: \($0)&quot;) },
          receiveValue: { print(&quot;ReceiveValue: \($0)&quot;) }
      )
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"tryMap"</span>) {

  <span class="hljs-type">Just</span>(<span class="hljs-string">"資料夾名稱不存在!!!"</span>)
      .tryMap { <span class="hljs-keyword">try</span> <span class="hljs-type">FileManager</span>.<span class="hljs-keyword">default</span>.contentsOfDirectory(atPath: $<span class="hljs-number">0</span>) }
      .sink(
          receiveCompletion: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"Completion: <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) },
          receiveValue: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"ReceiveValue: <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) }
      )
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: tryMap ===
Completion: failure(Error Domain=NSCocoaErrorDomain Code=260 &quot;The folder “資料夾名稱不存在!!!” doesn’t exist.&quot; UserInfo={NSUserStringVariant=(
  Folder
), NSFilePath=資料夾名稱不存在!!!, NSUnderlyingError=0x600003aff900 {Error Domain=NSPOSIXErrorDomain Code=2 &quot;No such file or directory&quot;}})
" class="bash hljs">=== 範例: tryMap ===
Completion: failure(Error Domain=NSCocoaErrorDomain Code=<span class="hljs-number">260</span> <span class="hljs-string">"The folder “資料夾名稱不存在!!!” doesn’t exist."</span> UserInfo={NSUserStringVariant=(
  Folder
), NSFilePath=資料夾名稱不存在!!!, NSUnderlyingError=<span class="hljs-number">0</span>x600003aff900 {Error Domain=NSPOSIXErrorDomain Code=<span class="hljs-number">2</span> <span class="hljs-string">"No such file or directory"</span>}})
</pre>
</li></ul><h3 id="[flatmap()](https://kingnight.github.io/programming/2020/10/29/combine中重要函数flatmap.html)"><a name="[flatmap()](https://kingnight.github.io/programming/2020/10/29/combine中重要函数flatmap.html)" href="#[flatmap()](https://kingnight.github.io/programming/2020/10/29/combine中重要函数flatmap.html)"></a><a href="https://kingnight.github.io/programming/2020/10/29/Combine中重要函数flatMap.html">flatMap()</a></h3><ul>
<li><p>字如其義，就是扁平化的意思 - flat，把Publishers =&gt; 單一個Publisher (Publisher轉換)</p>
<pre data-origin="example(of: &quot;flatMap&quot;) {

  func decode(_ codes: [Int]) -&amp;gt; AnyPublisher&amp;lt;String, Never&amp;gt; {

      Just(codes.compactMap { code in
          guard (32...255).contains(code) else { return nil }
          return String(UnicodeScalar(code) ?? &quot; &quot;)
      }.joined())
      .eraseToAnyPublisher()
  }

  let array = [72, 101, 108, 108, 111, 44, 32, 87, 111, 114, 108, 100, 33, 33, 33]    /// Hello, World!!! (ASCII)

  array.publisher
      .collect()
      .flatMap(decode)                                                                /// 可以接收一個個數值 Publishers =&amp;gt; 單一個Publisher
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"flatMap"</span>) {

  <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">decode</span><span class="hljs-params">(<span class="hljs-number">_</span> codes: [Int])</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Never</span>&gt; {

      <span class="hljs-type">Just</span>(codes.compactMap { code <span class="hljs-keyword">in</span>
          <span class="hljs-keyword">guard</span> (<span class="hljs-number">32</span>...<span class="hljs-number">255</span>).<span class="hljs-built_in">contains</span>(code) <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> }
          <span class="hljs-keyword">return</span> <span class="hljs-type">String</span>(<span class="hljs-type">UnicodeScalar</span>(code) ?? <span class="hljs-string">" "</span>)
      }.joined())
      .eraseToAnyPublisher()
  }

  <span class="hljs-keyword">let</span> array = [<span class="hljs-number">72</span>, <span class="hljs-number">101</span>, <span class="hljs-number">108</span>, <span class="hljs-number">108</span>, <span class="hljs-number">111</span>, <span class="hljs-number">44</span>, <span class="hljs-number">32</span>, <span class="hljs-number">87</span>, <span class="hljs-number">111</span>, <span class="hljs-number">114</span>, <span class="hljs-number">108</span>, <span class="hljs-number">100</span>, <span class="hljs-number">33</span>, <span class="hljs-number">33</span>, <span class="hljs-number">33</span>]    <span class="hljs-comment">/// Hello, World!!! (ASCII)</span>

  array.publisher
      .collect()
      .flatMap(decode)                                                                <span class="hljs-comment">/// 可以接收一個個數值 Publishers =&gt; 單一個Publisher</span>
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: flatMap ===
Hello, World!!!
" class="bash hljs">=== 範例: flatMap ===
Hello, World!!!
</pre>
</li></ul><h3 id="[replacenil(with:)](https://cocoacasts.com/combine-essentials-how-to-use-combine%27s-replacenil-operator)"><a name="[replacenil(with:)](https://cocoacasts.com/combine-essentials-how-to-use-combine%27s-replacenil-operator)" href="#[replacenil(with:)](https://cocoacasts.com/combine-essentials-how-to-use-combine%27s-replacenil-operator)"></a><a href="https://cocoacasts.com/combine-essentials-how-to-use-combine%27s-replacenil-operator">replaceNil(with:)</a></h3><ul>
<li>字如其義，就是處理nil值，有點像 (value ?? “-“)<pre data-origin="// 06. 處理nil數值 =&amp;gt; 有點像 (value ?? &quot;-&quot;)
example(of: &quot;replaceNil&quot;) {
  [&quot;A&quot;, nil, &quot;C&quot;].publisher
      .eraseToAnyPublisher()
      .replaceNil(with: &quot;-&quot;)      /// 可以試試不使用它的結果
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs"><span class="hljs-comment">// 06. 處理nil數值 =&gt; 有點像 (value ?? "-")</span>
example(of: <span class="hljs-string">"replaceNil"</span>) {
  [<span class="hljs-string">"A"</span>, <span class="hljs-literal">nil</span>, <span class="hljs-string">"C"</span>].publisher
      .eraseToAnyPublisher()
      .replaceNil(with: <span class="hljs-string">"-"</span>)      <span class="hljs-comment">/// 可以試試不使用它的結果</span>
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: replaceNil ===
A
-
C
" class="bash hljs">=== 範例: replaceNil ===
A
-
C
</pre>
</li></ul><h3 id="[replaceempty(with:)](https://juejin.cn/post/7017356750735015966)"><a name="[replaceempty(with:)](https://juejin.cn/post/7017356750735015966)" href="#[replaceempty(with:)](https://juejin.cn/post/7017356750735015966)"></a><a href="https://juejin.cn/post/7017356750735015966">replaceEmpty(with:)</a></h3><ul>
<li>字如其義，就是處理空值，用在演示或測試用</li><li><pre data-origin="example(of: &quot;replaceEmpty(with:)&quot;) {

  let empty = Empty&amp;lt;String, Never&amp;gt;()

  empty
      .replaceEmpty(with: &quot;Test&quot;)      /// 可以試試不使用它的結果
      .sink(
          receiveCompletion: { print($0) },
          receiveValue: { print($0) }
      )
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"replaceEmpty(with:)"</span>) {

  <span class="hljs-keyword">let</span> empty = <span class="hljs-type">Empty</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Never</span>&gt;()

  empty
      .replaceEmpty(with: <span class="hljs-string">"Test"</span>)      <span class="hljs-comment">/// 可以試試不使用它的結果</span>
      .sink(
          receiveCompletion: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) },
          receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) }
      )
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: replaceEmpty(with:) ===
Test
finished
" class="bash hljs">=== 範例: replaceEmpty(with:) ===
Test
finished
</pre>
</li></ul><h3 id="[scan()](https://juejin.cn/s/swift-combine-scan-example)"><a name="[scan()](https://juejin.cn/s/swift-combine-scan-example)" href="#[scan()](https://juejin.cn/s/swift-combine-scan-example)"></a><a href="https://juejin.cn/s/swift combine scan example">scan()</a></h3><ul>
<li>累加之用，很像<a href="https://medium.com/彼得潘的-swift-ios-app-開發教室/array-的高階函式-filter-map-and-reduce-39fb8ba5a9f7">reduce()</a></li><li><pre data-origin="example(of: &quot;scan&quot;) {

  let initValue = 50
  let maxCount = 10
  var dailyGainLoss: Int { .random(in: -maxCount...maxCount) }    /// 將產生-10 ~ 10的隨時數

  let june2023 = (0..&amp;lt;maxCount)                                   /// 產生10組
      .map { _ in dailyGainLoss }                                 /// [Int]
      .publisher

  june2023
      .scan(initValue) { latest, current in
          max(0, latest + current)                                /// 累加
      }
      .sink(receiveValue: { _ in })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"scan"</span>) {

  <span class="hljs-keyword">let</span> initValue = <span class="hljs-number">50</span>
  <span class="hljs-keyword">let</span> maxCount = <span class="hljs-number">10</span>
  <span class="hljs-keyword">var</span> dailyGainLoss: <span class="hljs-type">Int</span> { .random(<span class="hljs-keyword">in</span>: -maxCount...maxCount) }    <span class="hljs-comment">/// 將產生-10 ~ 10的隨時數</span>

  <span class="hljs-keyword">let</span> june2023 = (<span class="hljs-number">0</span>..&lt;maxCount)                                   <span class="hljs-comment">/// 產生10組</span>
      .<span class="hljs-built_in">map</span> { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> dailyGainLoss }                                 <span class="hljs-comment">/// [Int]</span>
      .publisher

  june2023
      .scan(initValue) { latest, current <span class="hljs-keyword">in</span>
          <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, latest + current)                                <span class="hljs-comment">/// 累加</span>
      }
      .sink(receiveValue: { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<p><img src="image/Scan.png" alt=""></p>
</li></ul><h2 id="lesson.03---過濾用的operator"><a name="lesson.03---過濾用的operator" href="#lesson.03---過濾用的operator"></a>Lesson.03 - 過濾用的Operator</h2><h3 id="[filter()](https://www.kodeco.com/books/combine-asynchronous-programming-with-swift/v2.0/chapters/4-filtering-operators)"><a name="[filter()](https://www.kodeco.com/books/combine-asynchronous-programming-with-swift/v2.0/chapters/4-filtering-operators)" href="#[filter()](https://www.kodeco.com/books/combine-asynchronous-programming-with-swift/v2.0/chapters/4-filtering-operators)"></a><a href="https://www.kodeco.com/books/combine-asynchronous-programming-with-swift/v2.0/chapters/4-filtering-operators">filter()</a></h3><ul>
<li>過濾之用，跟<a href="https://www.inote.tw/swift-array-filter">filter()</a>很像</li><li><pre data-origin="example(of: &quot;filter&quot;) {

  let multiple = 3
  let numbers = (1...10).publisher

  numbers
      .filter { $0.isMultiple(of: multiple) }
      .sink(receiveValue: { number in print(&quot;\(number) 是 \(multiple) 的倍數 !!!&quot;)})
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"filter"</span>) {

  <span class="hljs-keyword">let</span> multiple = <span class="hljs-number">3</span>
  <span class="hljs-keyword">let</span> numbers = (<span class="hljs-number">1</span>...<span class="hljs-number">10</span>).publisher

  numbers
      .<span class="hljs-built_in">filter</span> { $<span class="hljs-number">0</span>.isMultiple(of: multiple) }
      .sink(receiveValue: { number <span class="hljs-keyword">in</span> <span class="hljs-built_in">print</span>(<span class="hljs-string">"<span class="hljs-subst">\(number)</span> 是 <span class="hljs-subst">\(multiple)</span> 的倍數 !!!"</span>)})
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: filter ===
3 是 3 的倍數 !!!
6 是 3 的倍數 !!!
9 是 3 的倍數 !!!
" class="bash hljs">=== 範例: filter ===
<span class="hljs-number">3</span> 是 <span class="hljs-number">3</span> 的倍數 !!!
<span class="hljs-number">6</span> 是 <span class="hljs-number">3</span> 的倍數 !!!
<span class="hljs-number">9</span> 是 <span class="hljs-number">3</span> 的倍數 !!!
</pre>
</li></ul><h3 id="[removeduplicates()](https://paigeshin1991.medium.com/swift-combine-removeduplicates-you-can-totally-misuse-it-if-you-dont-read-this-9bf9c3c36296)"><a name="[removeduplicates()](https://paigeshin1991.medium.com/swift-combine-removeduplicates-you-can-totally-misuse-it-if-you-dont-read-this-9bf9c3c36296)" href="#[removeduplicates()](https://paigeshin1991.medium.com/swift-combine-removeduplicates-you-can-totally-misuse-it-if-you-dont-read-this-9bf9c3c36296)"></a><a href="https://paigeshin1991.medium.com/swift-combine-removeduplicates-you-can-totally-misuse-it-if-you-dont-read-this-9bf9c3c36296">removeDuplicates()</a></h3><ul>
<li><p>取得非重複資料，跟SQL的<a href="https://www.fooish.com/sql/distinct.html">SELECT DISTINCT</a>功能很像</p>
<pre data-origin="example(of: &quot;removeDuplicates&quot;) {

let words = &quot;hey hey there! want to listen to mister mister ?&quot;
                .components(separatedBy: &quot; &quot;)
                .publisher
words
  .removeDuplicates()
  .sink(receiveValue: { print($0) })
  .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"removeDuplicates"</span>) {

<span class="hljs-keyword">let</span> words = <span class="hljs-string">"hey hey there! want to listen to mister mister ?"</span>
                .components(separatedBy: <span class="hljs-string">" "</span>)
                .publisher
words
  .removeDuplicates()
  .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
  .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="hey
there!
want
to
listen
to
mister
?
" class="bash hljs">hey
there!
want
to
listen
to
mister
?
</pre>
</li></ul><h3 id="[compactmap()](https://juejin.cn/post/7017623451858894862)"><a name="[compactmap()](https://juejin.cn/post/7017623451858894862)" href="#[compactmap()](https://juejin.cn/post/7017623451858894862)"></a><a href="https://juejin.cn/post/7017623451858894862">compactMap()</a></h3><ul>
<li><p>把Optional值去除，跟<a href="https://medium.com/jeremy-xue-s-blog/swift-transforming-an-array-e2bcb4f4d67d">compactMap()</a>很像</p>
<pre data-origin="example(of: &quot;compactMap&quot;) {

  let strings = [&quot;a&quot;, &quot;1.24&quot;, &quot;3&quot;, &quot;def&quot;, &quot;45&quot;, &quot;0.23&quot;].publisher

  strings
      .compactMap { Float($0) }               /// 過濾Float
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"compactMap"</span>) {

  <span class="hljs-keyword">let</span> strings = [<span class="hljs-string">"a"</span>, <span class="hljs-string">"1.24"</span>, <span class="hljs-string">"3"</span>, <span class="hljs-string">"def"</span>, <span class="hljs-string">"45"</span>, <span class="hljs-string">"0.23"</span>].publisher

  strings
      .compactMap { <span class="hljs-type">Float</span>($<span class="hljs-number">0</span>) }               <span class="hljs-comment">/// 過濾Float</span>
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: compactMap ===
1.24
3.0
45.0
0.23
" class="bash hljs">=== 範例: compactMap ===
<span class="hljs-number">1.24</span>
<span class="hljs-number">3.0</span>
<span class="hljs-number">45.0</span>
<span class="hljs-number">0.23</span>
</pre>
</li></ul><h3 id="[ignoreoutput()](https://www.kodeco.com/books/combine-asynchronous-programming-with-swift/v3.0/chapters/4-filtering-operators)"><a name="[ignoreoutput()](https://www.kodeco.com/books/combine-asynchronous-programming-with-swift/v3.0/chapters/4-filtering-operators)" href="#[ignoreoutput()](https://www.kodeco.com/books/combine-asynchronous-programming-with-swift/v3.0/chapters/4-filtering-operators)"></a><a href="https://www.kodeco.com/books/combine-asynchronous-programming-with-swift/v3.0/chapters/4-filtering-operators">ignoreOutput()</a></h3><ul>
<li><p>取得的值不重要，只關心<a href="https://zhuanlan.zhihu.com/p/341961251">完成</a>了沒有</p>
<pre data-origin="example(of: &quot;ignoreOutput&quot;) {

  let numbers = (1...10_000).publisher

  numbers
      .ignoreOutput()
      .sink(
          receiveCompletion: { print(&quot;完成: \($0)&quot;) },
          receiveValue: { print($0) }
      )
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"ignoreOutput"</span>) {

  <span class="hljs-keyword">let</span> numbers = (<span class="hljs-number">1</span>...<span class="hljs-number">10_000</span>).publisher

  numbers
      .ignoreOutput()
      .sink(
          receiveCompletion: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"完成: <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) },
          receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) }
      )
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: ignoreOutput ===
完成: finished
" class="bash hljs">=== 範例: ignoreOutput ===
完成: finished
</pre>
</li></ul><h3 id="[first(where:)](https://juejin.cn/post/7017623451858894862)"><a name="[first(where:)](https://juejin.cn/post/7017623451858894862)" href="#[first(where:)](https://juejin.cn/post/7017623451858894862)"></a><a href="https://juejin.cn/post/7017623451858894862">first(where:)</a></h3><ul>
<li><p>取得第一個符合過濾的值</p>
<pre data-origin="example(of: &quot;first(where:)&quot;) {

  let multiple = 2
  let numbers = (1...9).publisher

  numbers
      .print(&quot;numbers&quot;)
      .first(where: { $0 % multiple == 0 })
      .sink(
          receiveCompletion: { print(&quot;完成: \($0)&quot;) },
          receiveValue: { print(&quot;第一個偶數: \($0)&quot;) }
      )
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"first(where:)"</span>) {

  <span class="hljs-keyword">let</span> multiple = <span class="hljs-number">2</span>
  <span class="hljs-keyword">let</span> numbers = (<span class="hljs-number">1</span>...<span class="hljs-number">9</span>).publisher

  numbers
      .<span class="hljs-built_in">print</span>(<span class="hljs-string">"numbers"</span>)
      .first(<span class="hljs-keyword">where</span>: { $<span class="hljs-number">0</span> % multiple == <span class="hljs-number">0</span> })
      .sink(
          receiveCompletion: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"完成: <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) },
          receiveValue: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"第一個偶數: <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) }
      )
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: first(where:) ===
numbers: receive subscription: (1...9)
numbers: request unlimited
numbers: receive value: (1)
numbers: receive value: (2)
numbers: receive cancel
第一個偶數: 2
完成: finished
" class="bash hljs">=== 範例: first(<span class="hljs-built_in">where</span>:) ===
numbers: receive subscription: (<span class="hljs-number">1</span>...<span class="hljs-number">9</span>)
numbers: request unlimited
numbers: receive value: (<span class="hljs-number">1</span>)
numbers: receive value: (<span class="hljs-number">2</span>)
numbers: receive cancel
第一個偶數: <span class="hljs-number">2</span>
完成: finished
</pre>
</li></ul><h3 id="[last(where:)](https://juejin.cn/post/7017623451858894862)"><a name="[last(where:)](https://juejin.cn/post/7017623451858894862)" href="#[last(where:)](https://juejin.cn/post/7017623451858894862)"></a><a href="https://juejin.cn/post/7017623451858894862">last(where:)</a></h3><ul>
<li>取得最後一個符合過濾的值</li><li><p>取得第一個很簡單，只要有符合就行了；但是最後一個的話，就要finished才可以</p>
<pre data-origin="example(of: &quot;last(where:)&quot;) {

  let numbers = PassthroughSubject&amp;lt;Int, Never&amp;gt;()

  numbers
      .last(where: { $0 % 2 == 0 })
      .sink(
          receiveCompletion: { print(&quot;完成: \($0)&quot;) },
          receiveValue: { print(&quot;最後一個偶數: \($0)&quot;) }
      )
      .store(in: &amp;amp;subscriptions)

  numbers.send(1)
  numbers.send(2)
  numbers.send(3)
  numbers.send(4)
  numbers.send(5)
  numbers.send(completion: .finished)        /// 要執行這個後才有值
}
" class="swift hljs">example(of: <span class="hljs-string">"last(where:)"</span>) {

  <span class="hljs-keyword">let</span> numbers = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()

  numbers
      .last(<span class="hljs-keyword">where</span>: { $<span class="hljs-number">0</span> % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> })
      .sink(
          receiveCompletion: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"完成: <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) },
          receiveValue: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"最後一個偶數: <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) }
      )
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  numbers.send(<span class="hljs-number">1</span>)
  numbers.send(<span class="hljs-number">2</span>)
  numbers.send(<span class="hljs-number">3</span>)
  numbers.send(<span class="hljs-number">4</span>)
  numbers.send(<span class="hljs-number">5</span>)
  numbers.send(completion: .finished)        <span class="hljs-comment">/// 要執行這個後才有值</span>
}
</pre>
<pre data-origin="=== 範例: last(where:) ===
最後一個偶數: 4
完成: finished
" class="bash hljs">=== 範例: last(<span class="hljs-built_in">where</span>:) ===
最後一個偶數: <span class="hljs-number">4</span>
完成: finished
</pre>
</li></ul><h3 id="[dropfirst()](https://www.kodeco.com/books/combine-asynchronous-programming-with-swift/v3.0/chapters/4-filtering-operators)"><a name="[dropfirst()](https://www.kodeco.com/books/combine-asynchronous-programming-with-swift/v3.0/chapters/4-filtering-operators)" href="#[dropfirst()](https://www.kodeco.com/books/combine-asynchronous-programming-with-swift/v3.0/chapters/4-filtering-operators)"></a><a href="https://www.kodeco.com/books/combine-asynchronous-programming-with-swift/v3.0/chapters/4-filtering-operators">dropFirst()</a></h3><ul>
<li><p>忽略掉前面的值</p>
<pre data-origin="example(of: &quot;dropFirst&quot;) {

  let numbers = (1...10).publisher

  numbers
      .dropFirst(8)       /// 忽略掉前8組
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"dropFirst"</span>) {

  <span class="hljs-keyword">let</span> numbers = (<span class="hljs-number">1</span>...<span class="hljs-number">10</span>).publisher

  numbers
      .<span class="hljs-built_in">dropFirst</span>(<span class="hljs-number">8</span>)       <span class="hljs-comment">/// 忽略掉前8組</span>
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: dropFirst ===
9
10
" class="bash hljs">=== 範例: dropFirst ===
<span class="hljs-number">9</span>
<span class="hljs-number">10</span>
</pre>
</li></ul><h3 id="[drop(while:)](https://juejin.cn/post/7017853525271150599)"><a name="[drop(while:)](https://juejin.cn/post/7017853525271150599)" href="#[drop(while:)](https://juejin.cn/post/7017853525271150599)"></a><a href="https://juejin.cn/post/7017853525271150599">drop(while:)</a></h3><ul>
<li><p>有條件的忽略掉數值</p>
<pre data-origin="example(of: &quot;drop(while:)&quot;) {

  let numbers = (1...10).publisher

  numbers
      .drop(while: { print(&quot;x&quot;); return $0 % 5 != 0})
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"drop(while:)"</span>) {

  <span class="hljs-keyword">let</span> numbers = (<span class="hljs-number">1</span>...<span class="hljs-number">10</span>).publisher

  numbers
      .drop(<span class="hljs-keyword">while</span>: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"x"</span>); <span class="hljs-keyword">return</span> $<span class="hljs-number">0</span> % <span class="hljs-number">5</span> != <span class="hljs-number">0</span>})
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: dropFirst ===
9
10
" class="bash hljs">=== 範例: dropFirst ===
<span class="hljs-number">9</span>
<span class="hljs-number">10</span>
</pre>
</li></ul><h3 id="[drop(while:)](https://juejin.cn/post/7017853525271150599)"><a name="[drop(while:)](https://juejin.cn/post/7017853525271150599)" href="#[drop(while:)](https://juejin.cn/post/7017853525271150599)"></a><a href="https://juejin.cn/post/7017853525271150599">drop(while:)</a></h3><ul>
<li><p>有條件的忽略掉數值</p>
<pre data-origin="example(of: &quot;drop(untilOutputFrom:)&quot;) {

  let isReady = PassthroughSubject&amp;lt;Void, Never&amp;gt;()
  let taps = PassthroughSubject&amp;lt;Int, Never&amp;gt;()

  taps.drop(untilOutputFrom: isReady)         /// 直到isReady變數發出值之後才動作
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)

  (1...5).forEach { n in
      taps.send(n)                            /// 在isReady發出值之前都是沒有用的
      if n == 3 { isReady.send() }            /// isReady發出值
  }
}
" class="swift hljs">example(of: <span class="hljs-string">"drop(untilOutputFrom:)"</span>) {

  <span class="hljs-keyword">let</span> isReady = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Void</span>, <span class="hljs-type">Never</span>&gt;()
  <span class="hljs-keyword">let</span> taps = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()

  taps.drop(untilOutputFrom: isReady)         <span class="hljs-comment">/// 直到isReady變數發出值之後才動作</span>
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  (<span class="hljs-number">1</span>...<span class="hljs-number">5</span>).forEach { n <span class="hljs-keyword">in</span>
      taps.send(n)                            <span class="hljs-comment">/// 在isReady發出值之前都是沒有用的</span>
      <span class="hljs-keyword">if</span> n == <span class="hljs-number">3</span> { isReady.send() }            <span class="hljs-comment">/// isReady發出值</span>
  }
}
</pre>
<pre data-origin="=== 範例: drop(untilOutputFrom:) ===
4
5
" class="bash hljs">=== 範例: drop(untilOutputFrom:) ===
<span class="hljs-number">4</span>
<span class="hljs-number">5</span>
</pre>
</li></ul><h3 id="[prefix(while:)](https://juejin.cn/post/7017853525271150599)"><a name="[prefix(while:)](https://juejin.cn/post/7017853525271150599)" href="#[prefix(while:)](https://juejin.cn/post/7017853525271150599)"></a><a href="https://juejin.cn/post/7017853525271150599">prefix(while:)</a></h3><ul>
<li><p>跟drop(while:)相反的功能，只取前面幾組，後面的不重要</p>
<pre data-origin="example(of: &quot;prefix(while:)&quot;) {

  let numbers = (1...10).publisher

  numbers
      .prefix(while: { $0 &amp;lt; 3 })
      .sink(
          receiveCompletion: { print(&quot;完成: \($0)&quot;) },
          receiveValue: { print($0) }
      )
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"prefix(while:)"</span>) {

  <span class="hljs-keyword">let</span> numbers = (<span class="hljs-number">1</span>...<span class="hljs-number">10</span>).publisher

  numbers
      .<span class="hljs-keyword">prefix</span>(<span class="hljs-keyword">while</span>: { $<span class="hljs-number">0</span> &lt; <span class="hljs-number">3</span> })
      .sink(
          receiveCompletion: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"完成: <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) },
          receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) }
      )
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: prefix(while:) ===
1
2
完成: finished
" class="bash hljs">=== 範例: prefix(<span class="hljs-keyword">while</span>:) ===
<span class="hljs-number">1</span>
<span class="hljs-number">2</span>
完成: finished
</pre>
</li></ul><h3 id="[prefix(while:)](https://juejin.cn/post/7017853525271150599)"><a name="[prefix(while:)](https://juejin.cn/post/7017853525271150599)" href="#[prefix(while:)](https://juejin.cn/post/7017853525271150599)"></a><a href="https://juejin.cn/post/7017853525271150599">prefix(while:)</a></h3><ul>
<li><p>跟drop(while:)相反的功能，只取前面幾組，後面的不重要</p>
<pre data-origin="example(of: &quot;prefix(while:)&quot;) {

  let numbers = (1...10).publisher

  numbers
      .prefix(while: { $0 &amp;lt; 3 })
      .sink(
          receiveCompletion: { print(&quot;完成: \($0)&quot;) },
          receiveValue: { print($0) }
      )
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"prefix(while:)"</span>) {

  <span class="hljs-keyword">let</span> numbers = (<span class="hljs-number">1</span>...<span class="hljs-number">10</span>).publisher

  numbers
      .<span class="hljs-keyword">prefix</span>(<span class="hljs-keyword">while</span>: { $<span class="hljs-number">0</span> &lt; <span class="hljs-number">3</span> })
      .sink(
          receiveCompletion: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"完成: <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) },
          receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) }
      )
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: prefix(while:) ===
1
2
完成: finished
" class="bash hljs">=== 範例: prefix(<span class="hljs-keyword">while</span>:) ===
<span class="hljs-number">1</span>
<span class="hljs-number">2</span>
完成: finished
</pre>
</li></ul><h3 id="[prefix(untiloutputfrom:)](https://juejin.cn/post/7017853525271150599)"><a name="[prefix(untiloutputfrom:)](https://juejin.cn/post/7017853525271150599)" href="#[prefix(untiloutputfrom:)](https://juejin.cn/post/7017853525271150599)"></a><a href="https://juejin.cn/post/7017853525271150599">prefix(untilOutputFrom:)</a></h3><ul>
<li><p>跟drop(untilOutputFrom:)相反的功能，只取前面幾組，後面的不重要</p>
<pre data-origin="example(of: &quot;prefix(untilOutputFrom:)&quot;) {

  let isReady = PassthroughSubject&amp;lt;Void, Never&amp;gt;()
  let taps = PassthroughSubject&amp;lt;Int, Never&amp;gt;()

  taps
      .prefix(untilOutputFrom: isReady)                   /// 直到isReady變數發出值之後不停止
      .sink(
          receiveCompletion: { print(&quot;完成: \($0)&quot;) },
          receiveValue: { print($0) }
      )
      .store(in: &amp;amp;subscriptions)

  (1...5).forEach { n in
      taps.send(n)                                        /// 在isReady發出值之前一直是有效的
      if n == 2 { isReady.send() }                        /// isReady發出值
  }
}
" class="swift hljs">example(of: <span class="hljs-string">"prefix(untilOutputFrom:)"</span>) {

  <span class="hljs-keyword">let</span> isReady = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Void</span>, <span class="hljs-type">Never</span>&gt;()
  <span class="hljs-keyword">let</span> taps = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()

  taps
      .<span class="hljs-keyword">prefix</span>(untilOutputFrom: isReady)                   <span class="hljs-comment">/// 直到isReady變數發出值之後不停止</span>
      .sink(
          receiveCompletion: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"完成: <span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>"</span>) },
          receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) }
      )
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  (<span class="hljs-number">1</span>...<span class="hljs-number">5</span>).forEach { n <span class="hljs-keyword">in</span>
      taps.send(n)                                        <span class="hljs-comment">/// 在isReady發出值之前一直是有效的</span>
      <span class="hljs-keyword">if</span> n == <span class="hljs-number">2</span> { isReady.send() }                        <span class="hljs-comment">/// isReady發出值</span>
  }
}
</pre>
<pre data-origin="=== 範例: prefix(untilOutputFrom:) ===
1
2
完成: finished
" class="bash hljs">=== 範例: prefix(untilOutputFrom:) ===
<span class="hljs-number">1</span>
<span class="hljs-number">2</span>
完成: finished
</pre>
</li></ul><h2 id="lesson.04---結合用的operator"><a name="lesson.04---結合用的operator" href="#lesson.04---結合用的operator"></a>Lesson.04 - 結合用的Operator</h2><h3 id="[prepend(output...)](https://juejin.cn/post/7018447582229692452)"><a name="[prepend(output...)](https://juejin.cn/post/7018447582229692452)" href="#[prepend(output...)](https://juejin.cn/post/7018447582229692452)"></a><a href="https://juejin.cn/post/7018447582229692452">prepend(Output…)</a></h3><ul>
<li><p>在原本的publisher之前加入數值，可以應用在一些一定要出現的介紹詞之上…</p>
<pre data-origin="example(of: &quot;prepend(Output...)&quot;) {

  let publisher = [&quot;新會員&quot;, &quot;William&quot;].publisher

  publisher
      .prepend(&quot;歡迎來到『人生40才開始』&quot;, &quot;別忘了繳入會費喲&quot;)   // 再在前面加上 [&quot;歡迎來到『人生40才開始』&quot;, &quot;別忘了繳入會費喲&quot;]
      .prepend(&quot;嗨!!!&quot;, &quot;您好&quot;)                            // 先在前面加上 [&quot;嗨!!!&quot;, &quot;您好&quot;]  =&amp;gt; [&quot;嗨!!!&quot;, &quot;您好&quot;, &quot;歡迎來到『人生40才開始』&quot;, &quot;別忘了繳入會費喲&quot;]
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"prepend(Output...)"</span>) {

  <span class="hljs-keyword">let</span> publisher = [<span class="hljs-string">"新會員"</span>, <span class="hljs-string">"William"</span>].publisher

  publisher
      .prepend(<span class="hljs-string">"歡迎來到『人生40才開始』"</span>, <span class="hljs-string">"別忘了繳入會費喲"</span>)   <span class="hljs-comment">// 再在前面加上 ["歡迎來到『人生40才開始』", "別忘了繳入會費喲"]</span>
      .prepend(<span class="hljs-string">"嗨!!!"</span>, <span class="hljs-string">"您好"</span>)                            <span class="hljs-comment">// 先在前面加上 ["嗨!!!", "您好"]  =&gt; ["嗨!!!", "您好", "歡迎來到『人生40才開始』", "別忘了繳入會費喲"]</span>
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: prepend(Output...) ===
嗨!!!
您好
歡迎來到『人生40才開始』
別忘了繳入會費喲
新會員
William
" class="bash hljs">=== 範例: prepend(Output...) ===
嗨!!!
您好
歡迎來到『人生<span class="hljs-number">40</span>才開始』
別忘了繳入會費喲
新會員
William
</pre>
</li></ul><h3 id="[prepend(sequence)]()"><a name="[prepend(sequence)]()" href="#[prepend(sequence)]()"></a><a href="">prepend(Sequence)</a></h3><ul>
<li>遵循<a href="https://developer.apple.com/documentation/swift/sequence">Sequence Protocol</a>的都可以使用</li><li><p>也就是有順序關係的，像：<a href="https://developer.apple.com/documentation/swift/array">Array</a> / <a href="https://developer.apple.com/documentation/swift/set">Set</a> / <a href="https://developer.apple.com/documentation/swift/stride(from:to:by:)">Stride</a></p>
<pre data-origin="example(of: &quot;prepend(Sequence)&quot;) {

  let publisher = [5, 6, 7].publisher
  let array = [3, 4]                              // Array也可以
  let set = Set(1...2)                            // Set也可以
  let stride = stride(from: 6, to: 11, by: 2)     // Stride也可以

  publisher
      .prepend(array)
      .prepend(set)
      .prepend(stride)
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"prepend(Sequence)"</span>) {

  <span class="hljs-keyword">let</span> publisher = [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>].publisher
  <span class="hljs-keyword">let</span> array = [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]                              <span class="hljs-comment">// Array也可以</span>
  <span class="hljs-keyword">let</span> <span class="hljs-keyword">set</span> = <span class="hljs-type">Set</span>(<span class="hljs-number">1</span>...<span class="hljs-number">2</span>)                            <span class="hljs-comment">// Set也可以</span>
  <span class="hljs-keyword">let</span> <span class="hljs-built_in">stride</span> = <span class="hljs-built_in">stride</span>(from: <span class="hljs-number">6</span>, to: <span class="hljs-number">11</span>, by: <span class="hljs-number">2</span>)     <span class="hljs-comment">// Stride也可以</span>

  publisher
      .prepend(array)
      .prepend(<span class="hljs-keyword">set</span>)
      .prepend(<span class="hljs-built_in">stride</span>)
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: prepend(Sequence) ===
6
8
10
1
2
3
4
5
6
7
" class="bash hljs">=== 範例: prepend(Sequence) ===
<span class="hljs-number">6</span>
<span class="hljs-number">8</span>
<span class="hljs-number">10</span>
<span class="hljs-number">1</span>
<span class="hljs-number">2</span>
<span class="hljs-number">3</span>
<span class="hljs-number">4</span>
<span class="hljs-number">5</span>
<span class="hljs-number">6</span>
<span class="hljs-number">7</span>
</pre>
</li></ul><h3 id="[prepend(publisher)](https://developer.apple.com/documentation/combine/publisher/prepend(_:%#41;-v9sb)"><a name="[prepend(publisher)](https://developer.apple.com/documentation/combine/publisher/prepend(_:%#41;-v9sb)" href="#[prepend(publisher)](https://developer.apple.com/documentation/combine/publisher/prepend(_:%#41;-v9sb)"></a><a href="https://developer.apple.com/documentation/combine/publisher/prepend(_:%#41;-v9sb">prepend(Publisher)</a></h3><ul>
<li><p>publisher當參數也可以</p>
<pre data-origin="example(of: &quot;prepend(Publisher)&quot;) {

  let publisher1 = [3, 4].publisher
  let publisher2 = [1, 2].publisher

  publisher1
      .prepend(publisher2)
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"prepend(Publisher)"</span>) {

  <span class="hljs-keyword">let</span> publisher1 = [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>].publisher
  <span class="hljs-keyword">let</span> publisher2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>].publisher

  publisher1
      .prepend(publisher2)
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: prepend(Publisher) ===
1
2
3
4
" class="bash hljs">=== 範例: prepend(Publisher) ===
<span class="hljs-number">1</span>
<span class="hljs-number">2</span>
<span class="hljs-number">3</span>
<span class="hljs-number">4</span>
</pre>
</li><li><p>這樣也行</p>
<pre data-origin="example(of: &quot;prepend(Publisher) #2&quot;) {

  let publisher1 = [3, 4].publisher
  let publisher2 = PassthroughSubject&amp;lt;Int, Never&amp;gt;()

  publisher1
      .prepend(publisher2)
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)

  publisher2.send(1)
  publisher2.send(2)
  publisher2.send(completion: .finished)
}
" class="swift hljs">example(of: <span class="hljs-string">"prepend(Publisher) #2"</span>) {

  <span class="hljs-keyword">let</span> publisher1 = [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>].publisher
  <span class="hljs-keyword">let</span> publisher2 = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()

  publisher1
      .prepend(publisher2)
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  publisher2.send(<span class="hljs-number">1</span>)
  publisher2.send(<span class="hljs-number">2</span>)
  publisher2.send(completion: .finished)
}
</pre>
<pre data-origin="=== 範例: prepend(Publisher) #2 ===
1
2
3
4
" class="bash hljs">=== 範例: prepend(Publisher) <span class="hljs-comment">#2 ===</span>
<span class="hljs-number">1</span>
<span class="hljs-number">2</span>
<span class="hljs-number">3</span>
<span class="hljs-number">4</span>
</pre>
</li></ul><h3 id="[append(output...)](https://juejin.cn/post/7018447582229692452)"><a name="[append(output...)](https://juejin.cn/post/7018447582229692452)" href="#[append(output...)](https://juejin.cn/post/7018447582229692452)"></a><a href="https://juejin.cn/post/7018447582229692452">append(Output…)</a></h3><ul>
<li><p>append正好跟prepend相反，它是加在後面的功能…</p>
<pre data-origin="example(of: &quot;append(Output...)&quot;) {

  let publisher = [&quot;您好&quot;, &quot;我是William&quot;].publisher

  publisher
      .append(&quot;-演出人員名單-&quot;, &quot;-配樂清單-&quot;)
      .append(&quot;~終~&quot;)
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"append(Output...)"</span>) {

  <span class="hljs-keyword">let</span> publisher = [<span class="hljs-string">"您好"</span>, <span class="hljs-string">"我是William"</span>].publisher

  publisher
      .append(<span class="hljs-string">"-演出人員名單-"</span>, <span class="hljs-string">"-配樂清單-"</span>)
      .append(<span class="hljs-string">"~終~"</span>)
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: append(Output...) ===
您好
我是William
-演出人員名單-
-配樂清單-
~終~
" class="bash hljs">=== 範例: append(Output...) ===
您好
我是William
-演出人員名單-
-配樂清單-
~終~
</pre>
</li><li><p>這樣也可以</p>
<pre data-origin="example(of: &quot;append(Output...) #2&quot;) {

  let publisher = PassthroughSubject&amp;lt;Int, Never&amp;gt;()

  publisher
      .append(3, 4)
      .append(5)
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)

  publisher.send(1)
  publisher.send(2)
  publisher.send(completion: .finished)
}
" class="swift hljs">example(of: <span class="hljs-string">"append(Output...) #2"</span>) {

  <span class="hljs-keyword">let</span> publisher = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()

  publisher
      .append(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)
      .append(<span class="hljs-number">5</span>)
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  publisher.send(<span class="hljs-number">1</span>)
  publisher.send(<span class="hljs-number">2</span>)
  publisher.send(completion: .finished)
}
</pre>
<pre data-origin="=== 範例: append(Output...) #2 ===
1
2
3
4
5
" class="bash hljs">=== 範例: append(Output...) <span class="hljs-comment">#2 ===</span>
<span class="hljs-number">1</span>
<span class="hljs-number">2</span>
<span class="hljs-number">3</span>
<span class="hljs-number">4</span>
<span class="hljs-number">5</span>
</pre>
</li></ul><h3 id="[append(sequence)](https://juejin.cn/post/7018447582229692452)"><a name="[append(sequence)](https://juejin.cn/post/7018447582229692452)" href="#[append(sequence)](https://juejin.cn/post/7018447582229692452)"></a><a href="https://juejin.cn/post/7018447582229692452">append(Sequence)</a></h3><ul>
<li><p>跟append(Sequence)相反，就不多做介紹了</p>
<pre data-origin="example(of: &quot;append(Sequence)&quot;) {

  let publisher = [1, 2, 3].publisher

  publisher
      .append([4, 5])
      .append(Set([6, 7]))
      .append(stride(from: 8, to: 11, by: 2))
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"append(Sequence)"</span>) {

  <span class="hljs-keyword">let</span> publisher = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].publisher

  publisher
      .append([<span class="hljs-number">4</span>, <span class="hljs-number">5</span>])
      .append(<span class="hljs-type">Set</span>([<span class="hljs-number">6</span>, <span class="hljs-number">7</span>]))
      .append(<span class="hljs-built_in">stride</span>(from: <span class="hljs-number">8</span>, to: <span class="hljs-number">11</span>, by: <span class="hljs-number">2</span>))
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: append(Sequence) ===
1
2
3
4
5
7
6
8
10
" class="bash hljs">=== 範例: append(Sequence) ===
<span class="hljs-number">1</span>
<span class="hljs-number">2</span>
<span class="hljs-number">3</span>
<span class="hljs-number">4</span>
<span class="hljs-number">5</span>
<span class="hljs-number">7</span>
<span class="hljs-number">6</span>
<span class="hljs-number">8</span>
<span class="hljs-number">10</span>
</pre>
</li></ul><h3 id="[append(publisher)](https://juejin.cn/post/7018447582229692452)"><a name="[append(publisher)](https://juejin.cn/post/7018447582229692452)" href="#[append(publisher)](https://juejin.cn/post/7018447582229692452)"></a><a href="https://juejin.cn/post/7018447582229692452">append(Publisher)</a></h3><ul>
<li><p>跟append(Publisher)相反，也不多做介紹了</p>
<pre data-origin="example(of: &quot;append(Publisher)&quot;) {

  let publisher1 = [1, 2].publisher
  let publisher2 = [3, 4].publisher

  publisher1
      .append(publisher2)
      .sink(receiveValue: { print($0) })
      .store(in: &amp;amp;subscriptions)
}
" class="swift hljs">example(of: <span class="hljs-string">"append(Publisher)"</span>) {

  <span class="hljs-keyword">let</span> publisher1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>].publisher
  <span class="hljs-keyword">let</span> publisher2 = [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>].publisher

  publisher1
      .append(publisher2)
      .sink(receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)
}
</pre>
<pre data-origin="=== 範例: append(Publisher) ===
1
2
3
4
" class="bash hljs">=== 範例: append(Publisher) ===
<span class="hljs-number">1</span>
<span class="hljs-number">2</span>
<span class="hljs-number">3</span>
<span class="hljs-number">4</span>
</pre>
</li></ul><h3 id="[switchtolatest](https://zhuanlan.zhihu.com/p/345054834)"><a name="[switchtolatest](https://zhuanlan.zhihu.com/p/345054834)" href="#[switchtolatest](https://zhuanlan.zhihu.com/p/345054834)"></a><a href="https://zhuanlan.zhihu.com/p/345054834">switchToLatest</a></h3><ul>
<li>切換到最後一個Publisher</li><li><p>在應用上的話，就像及時搜尋單字框，會一直送request，但是我們只需要最後一次的單字就好，中間的不要動作，減少多餘的request發送</p>
<pre data-origin="example(of: &quot;switchToLatest&quot;) {

  let publisher1 = PassthroughSubject&amp;lt;Int, Never&amp;gt;()
  let publisher2 = PassthroughSubject&amp;lt;Int, Never&amp;gt;()
  let publisher3 = PassthroughSubject&amp;lt;Int, Never&amp;gt;()
  let publishers = PassthroughSubject&amp;lt;PassthroughSubject&amp;lt;Int, Never&amp;gt;, Never&amp;gt;()

  publishers
      .switchToLatest()
      .sink(
          receiveCompletion: { _ in print(&quot;Completed!&quot;) },
          receiveValue: { print($0) }
      )
      .store(in: &amp;amp;subscriptions)

  publishers.send(publisher1)
  publisher1.send(1)
  publisher1.send(2)

  publishers.send(publisher2)
  publisher1.send(3)
  publisher2.send(4)
  publisher2.send(5)

  publishers.send(publisher3)
  publisher2.send(6)
  publisher3.send(7)
  publisher3.send(8)
  publisher3.send(9)

  publisher3.send(completion: .finished)
  publishers.send(completion: .finished)
}
" class="swift hljs">example(of: <span class="hljs-string">"switchToLatest"</span>) {

  <span class="hljs-keyword">let</span> publisher1 = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()
  <span class="hljs-keyword">let</span> publisher2 = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()
  <span class="hljs-keyword">let</span> publisher3 = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()
  <span class="hljs-keyword">let</span> publishers = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;, <span class="hljs-type">Never</span>&gt;()

  publishers
      .switchToLatest()
      .sink(
          receiveCompletion: { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">print</span>(<span class="hljs-string">"Completed!"</span>) },
          receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) }
      )
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  publishers.send(publisher1)
  publisher1.send(<span class="hljs-number">1</span>)
  publisher1.send(<span class="hljs-number">2</span>)

  publishers.send(publisher2)
  publisher1.send(<span class="hljs-number">3</span>)
  publisher2.send(<span class="hljs-number">4</span>)
  publisher2.send(<span class="hljs-number">5</span>)

  publishers.send(publisher3)
  publisher2.send(<span class="hljs-number">6</span>)
  publisher3.send(<span class="hljs-number">7</span>)
  publisher3.send(<span class="hljs-number">8</span>)
  publisher3.send(<span class="hljs-number">9</span>)

  publisher3.send(completion: .finished)
  publishers.send(completion: .finished)
}
</pre>
<pre data-origin="=== 範例: switchToLatest ===
publisher1 - 1
publisher1 - 2
publisher2 - 4
publisher2 - 5
publisher3 - 7
publisher3 - 8
publisher3 - 9
Completed!
" class="bash hljs">=== 範例: switchToLatest ===
publisher1 - <span class="hljs-number">1</span>
publisher1 - <span class="hljs-number">2</span>
publisher2 - <span class="hljs-number">4</span>
publisher2 - <span class="hljs-number">5</span>
publisher3 - <span class="hljs-number">7</span>
publisher3 - <span class="hljs-number">8</span>
publisher3 - <span class="hljs-number">9</span>
Completed!
</pre>
</li><li><p>實際應用<br><img src="image/SwitchToLatest.png" alt=""></p>
<pre data-origin="example(of: &quot;switchToLatest - Network Request&quot;) {

  let url = URL(string: &quot;https://picsum.photos/128&quot;)!
  let taps = PassthroughSubject&amp;lt;Void, Never&amp;gt;()

  taps.map { _ in getImage() }
      .switchToLatest()
      .sink(receiveValue: { _ in })
      .store(in: &amp;amp;subscriptions)

  taps.send()                                                                            // 下載圖片動作
  DispatchQueue.main.asyncAfter(deadline: .now() + 3.0) { print(Date()); taps.send() }
  DispatchQueue.main.asyncAfter(deadline: .now() + 3.1) { print(Date()); taps.send() }
  DispatchQueue.main.asyncAfter(deadline: .now() + 3.2) { print(Date()); taps.send() }
  DispatchQueue.main.asyncAfter(deadline: .now() + 3.3) { print(Date()); taps.send() }
  DispatchQueue.main.asyncAfter(deadline: .now() + 3.4) { print(Date()); taps.send() }   // 只會留這一個下載圖片動作

  func getImage() -&amp;gt; AnyPublisher&amp;lt;UIImage?, Never&amp;gt; {

      URLSession.shared
          .dataTaskPublisher(for: url)
          .map { data, _ in UIImage(data: data) }
          .print(&quot;[image]&quot;)
          .replaceError(with: nil)
          .eraseToAnyPublisher()
  }
}
" class="swift hljs">example(of: <span class="hljs-string">"switchToLatest - Network Request"</span>) {

  <span class="hljs-keyword">let</span> url = <span class="hljs-type">URL</span>(string: <span class="hljs-string">"https://picsum.photos/128"</span>)!
  <span class="hljs-keyword">let</span> taps = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Void</span>, <span class="hljs-type">Never</span>&gt;()

  taps.<span class="hljs-built_in">map</span> { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> getImage() }
      .switchToLatest()
      .sink(receiveValue: { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> })
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  taps.send()                                                                            <span class="hljs-comment">// 下載圖片動作</span>
  <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="hljs-number">3.0</span>) { <span class="hljs-built_in">print</span>(<span class="hljs-type">Date</span>()); taps.send() }
  <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="hljs-number">3.1</span>) { <span class="hljs-built_in">print</span>(<span class="hljs-type">Date</span>()); taps.send() }
  <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="hljs-number">3.2</span>) { <span class="hljs-built_in">print</span>(<span class="hljs-type">Date</span>()); taps.send() }
  <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="hljs-number">3.3</span>) { <span class="hljs-built_in">print</span>(<span class="hljs-type">Date</span>()); taps.send() }
  <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="hljs-number">3.4</span>) { <span class="hljs-built_in">print</span>(<span class="hljs-type">Date</span>()); taps.send() }   <span class="hljs-comment">// 只會留這一個下載圖片動作</span>

  <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">getImage</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">UIImage</span>?, <span class="hljs-type">Never</span>&gt; {

      <span class="hljs-type">URLSession</span>.shared
          .dataTaskPublisher(<span class="hljs-keyword">for</span>: url)
          .<span class="hljs-built_in">map</span> { data, <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> <span class="hljs-type">UIImage</span>(data: data) }
          .<span class="hljs-built_in">print</span>(<span class="hljs-string">"[image]"</span>)
          .replaceError(with: <span class="hljs-literal">nil</span>)
          .eraseToAnyPublisher()
  }
}
</pre>
<pre data-origin="=== 範例: switchToLatest - Network Request ===
[image]: receive subscription: (DataTaskPublisher)
[image]: request unlimited
[image]: receive value: (Optional(&amp;lt;UIImage:0x600001eec480 anonymous {128, 128} renderingMode=automatic(original)&amp;gt;))
[image]: receive finished
2023-05-30 07:02:02 +0000
[image]: receive subscription: (DataTaskPublisher)
[image]: request unlimited
2023-05-30 07:02:02 +0000
[image]: receive cancel
[image]: receive subscription: (DataTaskPublisher)
[image]: request unlimited
2023-05-30 07:02:02 +0000
[image]: receive cancel
[image]: receive subscription: (DataTaskPublisher)
[image]: request unlimited
2023-05-30 07:02:02 +0000
[image]: receive cancel
[image]: receive subscription: (DataTaskPublisher)
[image]: request unlimited
2023-05-30 07:02:02 +0000
[image]: receive cancel
[image]: receive subscription: (DataTaskPublisher)
[image]: request unlimited
[image]: receive value: (Optional(&amp;lt;UIImage:0x600001eec5a0 anonymous {128, 128} renderingMode=automatic(original)&amp;gt;))
[image]: receive finished
" class="bash hljs">=== 範例: switchToLatest - Network Request ===
[image]: receive subscription: (DataTaskPublisher)
[image]: request unlimited
[image]: receive value: (Optional(&lt;UIImage:<span class="hljs-number">0</span>x600001eec480 anonymous {<span class="hljs-number">128</span>, <span class="hljs-number">128</span>} renderingMode=automatic(original)&gt;))
[image]: receive finished
<span class="hljs-number">2023</span>-<span class="hljs-number">05</span>-<span class="hljs-number">30</span> <span class="hljs-number">07</span>:<span class="hljs-number">02</span>:<span class="hljs-number">02</span> +<span class="hljs-number">0000</span>
[image]: receive subscription: (DataTaskPublisher)
[image]: request unlimited
<span class="hljs-number">2023</span>-<span class="hljs-number">05</span>-<span class="hljs-number">30</span> <span class="hljs-number">07</span>:<span class="hljs-number">02</span>:<span class="hljs-number">02</span> +<span class="hljs-number">0000</span>
[image]: receive cancel
[image]: receive subscription: (DataTaskPublisher)
[image]: request unlimited
<span class="hljs-number">2023</span>-<span class="hljs-number">05</span>-<span class="hljs-number">30</span> <span class="hljs-number">07</span>:<span class="hljs-number">02</span>:<span class="hljs-number">02</span> +<span class="hljs-number">0000</span>
[image]: receive cancel
[image]: receive subscription: (DataTaskPublisher)
[image]: request unlimited
<span class="hljs-number">2023</span>-<span class="hljs-number">05</span>-<span class="hljs-number">30</span> <span class="hljs-number">07</span>:<span class="hljs-number">02</span>:<span class="hljs-number">02</span> +<span class="hljs-number">0000</span>
[image]: receive cancel
[image]: receive subscription: (DataTaskPublisher)
[image]: request unlimited
<span class="hljs-number">2023</span>-<span class="hljs-number">05</span>-<span class="hljs-number">30</span> <span class="hljs-number">07</span>:<span class="hljs-number">02</span>:<span class="hljs-number">02</span> +<span class="hljs-number">0000</span>
[image]: receive cancel
[image]: receive subscription: (DataTaskPublisher)
[image]: request unlimited
[image]: receive value: (Optional(&lt;UIImage:<span class="hljs-number">0</span>x600001eec5a0 anonymous {<span class="hljs-number">128</span>, <span class="hljs-number">128</span>} renderingMode=automatic(original)&gt;))
[image]: receive finished
</pre>
</li></ul><h3 id="[merge(with:)](https://ithelp.ithome.com.tw/articles/10221533)"><a name="[merge(with:)](https://ithelp.ithome.com.tw/articles/10221533)" href="#[merge(with:)](https://ithelp.ithome.com.tw/articles/10221533)"></a><a href="https://ithelp.ithome.com.tw/articles/10221533">merge(with:)</a></h3><ul>
<li><p>把Publisher們合併在一起</p>
<pre data-origin="example(of: &quot;merge(with:)&quot;) {

  let publisher1 = PassthroughSubject&amp;lt;Int, Never&amp;gt;()
  let publisher2 = PassthroughSubject&amp;lt;Int, Never&amp;gt;()

  publisher1
      .merge(with: publisher2)
      .sink(
          receiveCompletion: { _ in print(&quot;Completed&quot;) },
          receiveValue: { print($0) }
      )
      .store(in: &amp;amp;subscriptions)

  publisher1.send(1)
  publisher1.send(2)

  publisher2.send(3)

  publisher1.send(4)

  publisher2.send(5)

  publisher1.send(completion: .finished)
  publisher2.send(completion: .finished)
}
" class="swift hljs">example(of: <span class="hljs-string">"merge(with:)"</span>) {

  <span class="hljs-keyword">let</span> publisher1 = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()
  <span class="hljs-keyword">let</span> publisher2 = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()

  publisher1
      .merge(with: publisher2)
      .sink(
          receiveCompletion: { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">print</span>(<span class="hljs-string">"Completed"</span>) },
          receiveValue: { <span class="hljs-built_in">print</span>($<span class="hljs-number">0</span>) }
      )
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  publisher1.send(<span class="hljs-number">1</span>)
  publisher1.send(<span class="hljs-number">2</span>)

  publisher2.send(<span class="hljs-number">3</span>)

  publisher1.send(<span class="hljs-number">4</span>)

  publisher2.send(<span class="hljs-number">5</span>)

  publisher1.send(completion: .finished)
  publisher2.send(completion: .finished)
}
</pre>
<pre data-origin="=== 範例: merge(with:) ===
1
2
3
4
5
Completed
" class="bash hljs">=== 範例: merge(with:) ===
<span class="hljs-number">1</span>
<span class="hljs-number">2</span>
<span class="hljs-number">3</span>
<span class="hljs-number">4</span>
<span class="hljs-number">5</span>
Completed
</pre>
</li></ul><h3 id="[combinelatest()](https://ithelp.ithome.com.tw/articles/10221533)"><a name="[combinelatest()](https://ithelp.ithome.com.tw/articles/10221533)" href="#[combinelatest()](https://ithelp.ithome.com.tw/articles/10221533)"></a><a href="https://ithelp.ithome.com.tw/articles/10221533">combineLatest()</a></h3><ul>
<li><p>合併最後的一個publisher</p>
<pre data-origin="example(of: &quot;combineLatest&quot;) {

  let publisher1 = PassthroughSubject&amp;lt;Int, Never&amp;gt;()
  let publisher2 = PassthroughSubject&amp;lt;String, Never&amp;gt;()

  publisher1
      .combineLatest(publisher2)
      .sink(
          receiveCompletion: { _ in print(&quot;Completed&quot;) },
          receiveValue: { print(&quot;(\($0), \($1))&quot;) }
      )
      .store(in: &amp;amp;subscriptions)

  publisher1.send(1)
  publisher2.send(&quot;a&quot;)

  publisher1.send(2)
  publisher2.send(&quot;b&quot;)

  publisher1.send(3)
  publisher2.send(&quot;c&quot;)

  publisher1.send(completion: .finished)
  publisher2.send(completion: .finished)
}
" class="swift hljs">example(of: <span class="hljs-string">"combineLatest"</span>) {

  <span class="hljs-keyword">let</span> publisher1 = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()
  <span class="hljs-keyword">let</span> publisher2 = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Never</span>&gt;()

  publisher1
      .combineLatest(publisher2)
      .sink(
          receiveCompletion: { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">print</span>(<span class="hljs-string">"Completed"</span>) },
          receiveValue: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"(<span class="hljs-subst">\($<span class="hljs-number">0</span>)</span>, <span class="hljs-subst">\($<span class="hljs-number">1</span>)</span>)"</span>) }
      )
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  publisher1.send(<span class="hljs-number">1</span>)
  publisher2.send(<span class="hljs-string">"a"</span>)

  publisher1.send(<span class="hljs-number">2</span>)
  publisher2.send(<span class="hljs-string">"b"</span>)

  publisher1.send(<span class="hljs-number">3</span>)
  publisher2.send(<span class="hljs-string">"c"</span>)

  publisher1.send(completion: .finished)
  publisher2.send(completion: .finished)
}
</pre>
<pre data-origin="=== 範例: combineLatest ===
(1, a)
(2, a)
(2, b)
(3, b)
(3, c)
Completed
" class="bash hljs">=== 範例: combineLatest ===
(<span class="hljs-number">1</span>, a)
(<span class="hljs-number">2</span>, a)
(<span class="hljs-number">2</span>, b)
(<span class="hljs-number">3</span>, b)
(<span class="hljs-number">3</span>, c)
Completed
</pre>
</li></ul><h3 id="[zip()](https://augmentedcode.io/2022/10/03/combine-publishers-merge-zip-and-combinelatest-on-ios/)"><a name="[zip()](https://augmentedcode.io/2022/10/03/combine-publishers-merge-zip-and-combinelatest-on-ios/)" href="#[zip()](https://augmentedcode.io/2022/10/03/combine-publishers-merge-zip-and-combinelatest-on-ios/)"></a><a href="https://augmentedcode.io/2022/10/03/combine-publishers-merge-zip-and-combinelatest-on-ios/">zip()</a></h3><ul>
<li><p>這個跟combineLatest不太一樣，它是一對一合併</p>
<pre data-origin="example(of: &quot;zip&quot;) {

  let publisher1 = PassthroughSubject&amp;lt;Int, Never&amp;gt;()
  let publisher2 = PassthroughSubject&amp;lt;String, Never&amp;gt;()

  publisher1
      .zip(publisher2)
      .sink(
          receiveCompletion: { _ in print(&quot;Completed&quot;) },
          receiveValue: { print(&quot;(\($0) ,\($1))&quot;) }
      )
      .store(in: &amp;amp;subscriptions)

  publisher1.send(1)
  publisher1.send(2)
  publisher2.send(&quot;a&quot;)
  publisher2.send(&quot;b&quot;)
  publisher1.send(3)
  publisher2.send(&quot;c&quot;)
  publisher2.send(&quot;d&quot;)
  publisher1.send(4)
  publisher2.send(&quot;e&quot;)

  publisher1.send(completion: .finished)
  publisher2.send(completion: .finished)
}
" class="swift hljs">example(of: <span class="hljs-string">"zip"</span>) {

  <span class="hljs-keyword">let</span> publisher1 = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Never</span>&gt;()
  <span class="hljs-keyword">let</span> publisher2 = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Never</span>&gt;()

  publisher1
      .<span class="hljs-built_in">zip</span>(publisher2)
      .sink(
          receiveCompletion: { <span class="hljs-number">_</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">print</span>(<span class="hljs-string">"Completed"</span>) },
          receiveValue: { <span class="hljs-built_in">print</span>(<span class="hljs-string">"(<span class="hljs-subst">\($<span class="hljs-number">0</span>)</span> ,<span class="hljs-subst">\($<span class="hljs-number">1</span>)</span>)"</span>) }
      )
      .store(<span class="hljs-keyword">in</span>: &amp;subscriptions)

  publisher1.send(<span class="hljs-number">1</span>)
  publisher1.send(<span class="hljs-number">2</span>)
  publisher2.send(<span class="hljs-string">"a"</span>)
  publisher2.send(<span class="hljs-string">"b"</span>)
  publisher1.send(<span class="hljs-number">3</span>)
  publisher2.send(<span class="hljs-string">"c"</span>)
  publisher2.send(<span class="hljs-string">"d"</span>)
  publisher1.send(<span class="hljs-number">4</span>)
  publisher2.send(<span class="hljs-string">"e"</span>)

  publisher1.send(completion: .finished)
  publisher2.send(completion: .finished)
}
</pre>
<pre data-origin="=== 範例: zip ===
(1 ,a)
(2 ,b)
(3 ,c)
(4 ,d)
Completed
" class="bash hljs">=== 範例: zip ===
(<span class="hljs-number">1</span> ,a)
(<span class="hljs-number">2</span> ,b)
(<span class="hljs-number">3</span> ,c)
(<span class="hljs-number">4</span> ,d)
Completed
</pre>
</li></ul>


</body>
</html>
